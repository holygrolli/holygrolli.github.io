

<!doctype html>
<html ⚡ lang="de">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta name="description" content="Auf der Cloud Next 2019 wurde Cloud Run vorgestellt: Container starten erst bei einem Aufruf und man bezahlt nur für die Dauer des Requests. Meine Erfahrungen."><link rel="preload" as="script" href="https://cdn.ampproject.org/v0.js">
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">
        
        <script async src="https://cdn.ampproject.org/v0.js"></script>

        <script async custom-element="amp-bind" src="https://cdn.ampproject.org/v0/amp-bind-0.1.js"></script>
        <script async custom-element="amp-lightbox-gallery" src="https://cdn.ampproject.org/v0/amp-lightbox-gallery-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script><script async custom-element="amp-ad" src="https://cdn.ampproject.org/v0/amp-ad-0.1.js"></script><script async custom-element="amp-consent" src="https://cdn.ampproject.org/v0/amp-consent-0.1.js"></script>
        <script async custom-element="amp-geo" src="https://cdn.ampproject.org/v0/amp-geo-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-web-push" src="https://cdn.ampproject.org/v0/amp-web-push-0.1.js"></script>
        <style amp-custom="">/*!Basscss | http://basscss.com | MIT License*/.h00{font-size:4rem;font-size:var(--h00)}.h0{font-size:3rem;font-size:var(--h0)}.h1{font-size:2rem;font-size:var(--h1)}.h2{font-size:1.5rem;font-size:var(--h2)}.h3{font-size:1.25rem;font-size:var(--h3)}.h4{font-size:1rem;font-size:var(--h4)}.h5{font-size:.875rem;font-size:var(--h5)}.h6{font-size:.75rem;font-size:var(--h6)}:root{--h00:4rem;--h0:3rem;--h1:2rem;--h2:1.5rem;--h3:1.25rem;--h4:1rem;--h5:.875rem;--h6:.75rem}.font-family-inherit{font-family:inherit}.font-size-inherit{font-size:inherit}.text-decoration-none{text-decoration:none}.bold{font-weight:700;font-weight:var(--bold-font-weight,bold)}.regular{font-weight:400}.italic{font-style:italic}.caps{text-transform:uppercase;letter-spacing:.2em;letter-spacing:var(--caps-letter-spacing)}.left-align{text-align:left}.center{text-align:center}.right-align{text-align:right}.justify{text-align:justify}.nowrap{white-space:nowrap}.break-word{word-wrap:break-word}.line-height-1{line-height:1;line-height:var(--line-height-1)}.line-height-2{line-height:1.125;line-height:var(--line-height-2)}.line-height-3{line-height:1.25;line-height:var(--line-height-3)}.line-height-4{line-height:1.5;line-height:var(--line-height-4)}.list-style-none{list-style:none}.underline{text-decoration:underline}.truncate{max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.list-reset{list-style:none;padding-left:0}:root{--line-height-1:1;--line-height-2:1.125;--line-height-3:1.25;--line-height-4:1.5;--caps-letter-spacing:.2em;--bold-font-weight:bold}.inline{display:inline}.block{display:block}.inline-block{display:inline-block}.table{display:table}.table-cell{display:table-cell}.overflow-hidden{overflow:hidden}.overflow-scroll{overflow:scroll}.overflow-auto{overflow:auto}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.left{float:left}.right{float:right}.fit{max-width:100%}.max-width-1{max-width:24rem;max-width:var(--width-1)}.max-width-2{max-width:32rem;max-width:var(--width-2)}.max-width-3{max-width:48rem;max-width:var(--width-3)}.max-width-4{max-width:64rem;max-width:var(--width-4)}.border-box{box-sizing:border-box}:root{--width-1:24rem;--width-2:32rem;--width-3:48rem;--width-4:64rem}.align-baseline{vertical-align:baseline}.align-top{vertical-align:top}.align-middle{vertical-align:middle}.align-bottom{vertical-align:bottom}.m0{margin:0}.mt0{margin-top:0}.mr0{margin-right:0}.mb0{margin-bottom:0}.ml0{margin-left:0}.mx0{margin-left:0;margin-right:0}.my0{margin-top:0;margin-bottom:0}.m1{margin:.5rem;margin:var(--space-1)}.mt1{margin-top:.5rem;margin-top:var(--space-1)}.mr1{margin-right:.5rem;margin-right:var(--space-1)}.mb1{margin-bottom:.5rem;margin-bottom:var(--space-1)}.ml1{margin-left:.5rem;margin-left:var(--space-1)}.mx1{margin-left:.5rem;margin-left:var(--space-1);margin-right:.5rem;margin-right:var(--space-1)}.my1{margin-top:.5rem;margin-top:var(--space-1);margin-bottom:.5rem;margin-bottom:var(--space-1)}.m2{margin:1rem;margin:var(--space-2)}.mt2{margin-top:1rem;margin-top:var(--space-2)}.mr2{margin-right:1rem;margin-right:var(--space-2)}.mb2{margin-bottom:1rem;margin-bottom:var(--space-2)}.ml2{margin-left:1rem;margin-left:var(--space-2)}.mx2{margin-left:1rem;margin-left:var(--space-2);margin-right:1rem;margin-right:var(--space-2)}.my2{margin-top:1rem;margin-top:var(--space-2);margin-bottom:1rem;margin-bottom:var(--space-2)}.m3{margin:2rem;margin:var(--space-3)}.mt3{margin-top:2rem;margin-top:var(--space-3)}.mr3{margin-right:2rem;margin-right:var(--space-3)}.mb3{margin-bottom:2rem;margin-bottom:var(--space-3)}.ml3{margin-left:2rem;margin-left:var(--space-3)}.mx3{margin-left:2rem;margin-left:var(--space-3);margin-right:2rem;margin-right:var(--space-3)}.my3{margin-top:2rem;margin-top:var(--space-3);margin-bottom:2rem;margin-bottom:var(--space-3)}.m4{margin:4rem;margin:var(--space-4)}.mt4{margin-top:4rem;margin-top:var(--space-4)}.mr4{margin-right:4rem;margin-right:var(--space-4)}.mb4{margin-bottom:4rem;margin-bottom:var(--space-4)}.ml4{margin-left:4rem;margin-left:var(--space-4)}.mx4{margin-left:4rem;margin-left:var(--space-4);margin-right:4rem;margin-right:var(--space-4)}.my4{margin-top:4rem;margin-top:var(--space-4);margin-bottom:4rem;margin-bottom:var(--space-4)}.mxn1{margin-left:-.5rem;margin-left:calc(var(--space-1)*-1);margin-right:-.5rem;margin-right:calc(var(--space-1)*-1)}.mxn2{margin-left:-1rem;margin-left:calc(var(--space-2)*-1);margin-right:-1rem;margin-right:calc(var(--space-2)*-1)}.mxn3{margin-left:-2rem;margin-left:calc(var(--space-3)*-1);margin-right:-2rem;margin-right:calc(var(--space-3)*-1)}.mxn4{margin-left:-4rem;margin-left:calc(var(--space-4)*-1);margin-right:-4rem;margin-right:calc(var(--space-4)*-1)}.m-auto{margin:auto}.mt-auto{margin-top:auto}.mr-auto{margin-right:auto}.mb-auto{margin-bottom:auto}.ml-auto{margin-left:auto}.mx-auto{margin-left:auto;margin-right:auto}.my-auto{margin-top:auto;margin-bottom:auto}:root{--space-1:.5rem;--space-2:1rem;--space-3:1.5rem;--space-4:2rem}.p0{padding:0}.pt0{padding-top:0}.pr0{padding-right:0}.pb0{padding-bottom:0}.pl0{padding-left:0}.px0{padding-left:0;padding-right:0}.py0{padding-top:0;padding-bottom:0}.p1{padding:.5rem;padding:var(--space-1)}.pt1{padding-top:.5rem;padding-top:var(--space-1)}.pr1{padding-right:.5rem;padding-right:var(--space-1)}.pb1{padding-bottom:.5rem;padding-bottom:var(--space-1)}.pl1{padding-left:.5rem;padding-left:var(--space-1)}.py1{padding-top:.5rem;padding-top:var(--space-1);padding-bottom:.5rem;padding-bottom:var(--space-1)}.px1{padding-left:.5rem;padding-left:var(--space-1);padding-right:.5rem;padding-right:var(--space-1)}.p2{padding:1rem;padding:var(--space-2)}.pt2{padding-top:1rem;padding-top:var(--space-2)}.pr2{padding-right:1rem;padding-right:var(--space-2)}.pb2{padding-bottom:1rem;padding-bottom:var(--space-2)}.pl2{padding-left:1rem;padding-left:var(--space-2)}.py2{padding-top:1rem;padding-top:var(--space-2);padding-bottom:1rem;padding-bottom:var(--space-2)}.px2{padding-left:1rem;padding-left:var(--space-2);padding-right:1rem;padding-right:var(--space-2)}.p3{padding:2rem;padding:var(--space-3)}.pt3{padding-top:2rem;padding-top:var(--space-3)}.pr3{padding-right:2rem;padding-right:var(--space-3)}.pb3{padding-bottom:2rem;padding-bottom:var(--space-3)}.pl3{padding-left:2rem;padding-left:var(--space-3)}.py3{padding-top:2rem;padding-top:var(--space-3);padding-bottom:2rem;padding-bottom:var(--space-3)}.px3{padding-left:2rem;padding-left:var(--space-3);padding-right:2rem;padding-right:var(--space-3)}.p4{padding:4rem;padding:var(--space-4)}.pt4{padding-top:4rem;padding-top:var(--space-4)}.pr4{padding-right:4rem;padding-right:var(--space-4)}.pb4{padding-bottom:4rem;padding-bottom:var(--space-4)}.pl4{padding-left:4rem;padding-left:var(--space-4)}.py4{padding-top:4rem;padding-top:var(--space-4);padding-bottom:4rem;padding-bottom:var(--space-4)}.px4{padding-left:4rem;padding-left:var(--space-4);padding-right:4rem;padding-right:var(--space-4)}:root{--space-1:.5rem;--space-2:1rem;--space-3:1.5rem;--space-4:2rem}.col{float:left;box-sizing:border-box}.col-right{float:right;box-sizing:border-box}.col-1{width:8.33333%}.col-2{width:16.66667%}.col-3{width:25%}.col-4{width:33.33333%}.col-5{width:41.66667%}.col-6{width:50%}.col-7{width:58.33333%}.col-8{width:66.66667%}.col-9{width:75%}.col-10{width:83.33333%}.col-11{width:91.66667%}.col-12{width:100%}@media(min-width:40em){.sm-col{float:left;box-sizing:border-box}.sm-col-right{float:right;box-sizing:border-box}.sm-col-1{width:8.33333%}.sm-col-2{width:16.66667%}.sm-col-3{width:25%}.sm-col-4{width:33.33333%}.sm-col-5{width:41.66667%}.sm-col-6{width:50%}.sm-col-7{width:58.33333%}.sm-col-8{width:66.66667%}.sm-col-9{width:75%}.sm-col-10{width:83.33333%}.sm-col-11{width:91.66667%}.sm-col-12{width:100%}}@media(min-width:52em){.md-col{float:left;box-sizing:border-box}.md-col-right{float:right;box-sizing:border-box}.md-col-1{width:8.33333%}.md-col-2{width:16.66667%}.md-col-3{width:25%}.md-col-4{width:33.33333%}.md-col-5{width:41.66667%}.md-col-6{width:50%}.md-col-7{width:58.33333%}.md-col-8{width:66.66667%}.md-col-9{width:75%}.md-col-10{width:83.33333%}.md-col-11{width:91.66667%}.md-col-12{width:100%}}@media(min-width:64em){.lg-col{float:left;box-sizing:border-box}.lg-col-right{float:right;box-sizing:border-box}.lg-col-1{width:8.33333%}.lg-col-2{width:16.66667%}.lg-col-3{width:25%}.lg-col-4{width:33.33333%}.lg-col-5{width:41.66667%}.lg-col-6{width:50%}.lg-col-7{width:58.33333%}.lg-col-8{width:66.66667%}.lg-col-9{width:75%}.lg-col-10{width:83.33333%}.lg-col-11{width:91.66667%}.lg-col-12{width:100%}}.flex{display:flex}@media(min-width:40em){.sm-flex{display:flex}}@media(min-width:52em){.md-flex{display:flex}}@media(min-width:64em){.lg-flex{display:flex}}.flex-column{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.items-baseline{align-items:baseline}.items-stretch{align-items:stretch}.self-start{align-self:flex-start}.self-end{align-self:flex-end}.self-center{align-self:center}.self-baseline{align-self:baseline}.self-stretch{align-self:stretch}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-around{justify-content:space-around}.justify-evenly{justify-content:space-evenly}.content-start{align-content:flex-start}.content-end{align-content:flex-end}.content-center{align-content:center}.content-between{align-content:space-between}.content-around{align-content:space-around}.content-stretch{align-content:stretch}.flex-auto{flex:1 1 auto;min-width:0;min-height:0}.flex-none{flex:none}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-last{order:99999}.relative{position:relative}.absolute{position:absolute}.fixed{position:fixed}.top-0{top:0}.right-0{right:0}.bottom-0{bottom:0}.left-0{left:0}.z1{z-index:1;z-index:var(--z1)}.z2{z-index:2;z-index:var(--z2)}.z3{z-index:3;z-index:var(--z3)}.z4{z-index:4;z-index:var(--z4)}:root{--z1:1;--z2:2;--z3:3;--z4:4}.border{border-style:solid;border-width:1px;border-width:var(--border-width)}.border-top{border-top-style:solid;border-top-width:1px;border-top-width:var(--border-width)}.border-right{border-right-style:solid;border-right-width:1px;border-right-width:var(--border-width)}.border-bottom{border-bottom-style:solid;border-bottom-width:1px;border-bottom-width:var(--border-width)}.border-left{border-left-style:solid;border-left-width:1px;border-left-width:var(--border-width)}.border-none{border:0}.rounded{border-radius:3px;border-radius:var(--border-radius)}.circle{border-radius:50%}.rounded-top{border-radius:3px 3px 0 0;border-radius:var(--border-radius) var(--border-radius) 0 0}.rounded-right{border-radius:0 3px 3px 0;border-radius:0 var(--border-radius) var(--border-radius) 0}.rounded-bottom{border-radius:0 0 3px 3px;border-radius:0 0 var(--border-radius) var(--border-radius)}.rounded-left{border-radius:3px 0 0 3px;border-radius:var(--border-radius) 0 0 var(--border-radius)}.not-rounded{border-radius:0}:root{--border-width:1px;--border-radius:3px}.hide{position:absolute;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px)}@media(max-width:40em){.xs-hide{display:none}}@media(min-width:40em) and (max-width:52em){.sm-hide{display:none}}@media(min-width:52em) and (max-width:64em){.md-hide{display:none}}@media(min-width:64em){.lg-hide{display:none}}.display-none{display:none}*{box-sizing:border-box}.ampstart-navbar-trigger{line-height:3.5rem;font-size:2rem}.ampstart-nav a,.ampstart-navbar-trigger,.ampstart-sidebar-faq a{cursor:pointer;text-decoration:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a,a:active,a:visited{color:inherit}.ampstart-headerbar-nav{-ms-flex:1;flex:1;line-height:3.5rem}.ampstart-headerbar-nav .ampstart-nav-item{padding:0 1rem;background:transparent;opacity:.8}.ampstart-fullpage-hero-heading{line-height:3.5rem}h1,h2,h3,h4,h5,h6{letter-spacing:.06rem}.h1,h1{font-size:3rem;line-height:3.5rem}.h2,h2{font-size:2rem;line-height:2.5rem}.h3,h3{font-size:1.5rem;line-height:2rem}.h4,h4{font-size:1.125rem;line-height:1.5rem}.h5,h5{font-size:.875rem;line-height:1.125rem}.h6,h6{font-size:.75rem;line-height:1rem}p{padding:0;margin:0}.ampstart-footer,.ampstart-small-text{font-size:.75rem;line-height:1rem;letter-spacing:.06rem}.ampstart-btn{font-family:inherit;font-weight:inherit;font-size:1rem;line-height:1.125rem;padding:.7em .8em;text-decoration:none;white-space:nowrap;word-wrap:normal;vertical-align:middle;cursor:pointer;background-color:#000;color:#fff;border:1px solid #fff}.ampstart-btn-secondary{background-color:#fff;color:#000;border:1px solid #000}figure.ampstart-image-fullpage-hero span.bgnone{background:0 0}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,courier new,monospace}code{padding:2px 4px;font-size:90%;color:#c7254e;background-color:#f9f2f4;border-radius:4px}kbd{padding:2px 4px;font-size:90%;color:#c7254e;background-color:#f9f2f4;border-radius:2px;box-shadow:inset 0 -1px 0 rgba(0,0,0,.25)}pre{display:block;line-height:1.4;font-size:13px;padding:5px;word-break:break-all;word-wrap:break-word;color:#333;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px}pre code{font-size:1em;padding:0;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0}body{font-family:amblelight,raleway,Helvetica,Arial,sans-serif;letter-spacing:.02em;font-size:20px;-webkit-tap-highlight-color:#0085a1;line-height:1.5rem;-webkit-font-smoothing:antialiased;color:#4a4a4a}header h1{font-weight:700;text-shadow:0 0 0 rgba(0,0,0,0),10px 7px 2px rgba(134,129,129,.36);text-decoration:none}.ampstart-headerbar,h1,h2,h3,h4,h5,h6{font-weight:800}h1,h2,h3,h4,h5,h6{margin-top:20px;margin-bottom:10px}a{text-decoration:none}a:focus,a:hover{color:#0085a1}article:not([class=post-preview]) a,.consentPopup a{text-decoration:underline}hr{margin-top:20px;margin-bottom:20px;border:0;border-top:1px solid #eee}hr.small{max-width:100px;margin:15px auto;border-color:#eee;border-width:4px}article p{margin:0 0 10px;line-height:1.5}blockquote{padding:10px 20px;margin:0 0 20px;font-size:17.5px;border-left:5px solid #eee;color:#777;font-style:italic}.contentwrapper{overflow:hidden}.content{float:none;width:100%;padding:0 15px}.sidebar{float:none;width:100%;padding:0 15px}.widget{overflow:hidden;font-size:80%}.border{border:1px solid #000}.widgetbg{border:1px solid #eee;background:#eee}article figure{margin:15px -15px 25px}article figcaption{padding:5px 15px;text-align:center;font-size:90%}.widget .title{font-size:120%}.ampstart-headerbar+amp-sidebar~figure.ampstart-image-fullpage-hero{margin-top:3.5rem}.intro-header .page-heading,.intro-header .post-heading,.intro-header .site-heading{padding:75px 0}.intro-header .page-heading h1,.intro-header .site-heading h1{font-size:60px}.intro-header .page-heading .title,.intro-header .site-heading .title{margin:0 2px}@media(min-width:64em){.contentwrapper{padding-right:340px;overflow:hidden}.content{float:left;width:100%;padding:0 60px}.sidebar{margin-right:-340px;padding:0 20px;width:340px;float:right}article figure{margin:0 0 25px}.intro-header .page-heading,.intro-header .post-heading,.intro-header .site-heading{padding:150px 0}.intro-header .page-heading h1,.intro-header .site-heading h1{font-size:80px}.intro-header .page-heading .title,.intro-header .site-heading .title{margin:0}}.avatar{max-width:190px}.pagination{display:inline-block;padding-left:0;margin:1rem;border-radius:2px}.pagination>li{display:inline}.pagination>li>a,.pagination>li>span{position:relative;float:left;padding:5px;line-height:1rem;text-decoration:none;color:#000;background-color:#fff;border:1px solid #000;margin-left:-1px}.pagination>li:first-child>a,.pagination>li:first-child>span{margin-left:0}.pagination>li>a:hover,.pagination>li>span:hover,.pagination>li>a:focus,.pagination>li>span:focus{z-index:2;color:#fff;background-color:#337ab7;border-color:#337ab7}.pagination>.active>a,.pagination>.active>span,.pagination>.active>a:hover,.pagination>.active>span:hover,.pagination>.active>a:focus,.pagination>.active>span:focus{z-index:3;color:#fff;background-color:#337ab7;border-color:#337ab7;cursor:default}.pagination>.disabled>a,.pagination>.disabled>span,.pagination>.disabled>a:hover,.pagination>.disabled>span:hover,.pagination>.disabled>a:focus,.pagination>.disabled>span:focus{color:#000;background-color:#fff;border-color:#337ab7;cursor:not-allowed}.intro-header{background:50% no-repeat;-webkit-background-size:cover;-moz-background-size:cover;background-size:cover;-o-background-size:cover;margin-bottom:50px;display:block}.header-bg{background:rgba(0,0,0,.2)}@media only screen and (min-width:768px){.intro-header .page-heading h1,.intro-header .site-heading h1{font-size:80px}}.intro-header .page-heading h1,.intro-header .site-heading h1{margin-top:0;font-size:50px}body>div.intro-header div.title{color:#fff;border:2px solid #fff;background:#000;background:rgba(0,0,0,.4)}.ampstart-headerbar{background-color:rgba(255,255,255,.7);color:#000;z-index:999;box-shadow:0 0 5px 2px rgba(0,0,0,.1)}amp-consent{background-color:#fff;border:1px solid red}amp-web-push-widget button.subscribe{display:inline-flex;align-items:center;border-radius:2px;border:0;box-sizing:border-box;margin:0;padding:10px 15px;cursor:pointer;outline:none;font-size:15px;font-weight:400;background:#4a90e2;color:#fff;box-shadow:0 1px 1px 0 rgba(0,0,0,.5);-webkit-tap-highlight-color:rgba(0,0,0,0)}amp-web-push-widget button.subscribe:active{transform:scale(0.99)}amp-web-push-widget button.unsubscribe{display:inline-flex;align-items:center;border-radius:2px;border:0;box-sizing:border-box;margin:0;padding:10px 15px;cursor:pointer;outline:none;font-size:15px;font-weight:400;background:#769ac3;color:#000;box-shadow:0 1px 1px 0 rgba(0,0,0,.5);-webkit-tap-highlight-color:rgba(0,0,0,0)}.imgwrapper{margin-left:auto;margin-right:auto}article table{width:100%;border-collapse:collapse;font-size:75%;margin-bottom:20px}article table td{border:1px solid gray;padding:0 5px}article table tr:nth-child(even){background:#ccc}article table tr:nth-child(odd){background:#fff}.dropdown .dropbtn{background-color:inherit;font-family:inherit}.dropdown-content{display:none;position:absolute;background-color:rgba(255,255,255,.7);min-width:160px;box-shadow:0 8px 16px 0 rgba(0,0,0,.2);z-index:1}.dropdown:hover .dropdown-content{display:block}#topnav{position:fixed;top:0;left:0;width:100vw;height:100vh;padding:40px 20px 80px;z-index:-1;background-color:#fff;pointer-events:none;opacity:0;transition:transform .2s ease,opacity .2s ease}#topnav.menuopen{z-index:100;opacity:1;pointer-events:auto}#topnav.menuopen .dropdown{float:none}#topnav.menuopen .dropdown-content{position:relative}#topnav.menuopen .dropdown .dropbtn{display:block;width:100%;text-align:left}.burger-menu-items{display:flex;flex-direction:column;height:100%;margin:0;margin-top:1rem;padding:0;overflow-y:auto}.burger-menu-items ul{display:none}.burger-menu-item-trigger:checked~ul{display:block}.burger-menu-item-trigger{position:absolute;left:0;top:0;width:100%;height:36px;padding:0;margin:0;opacity:0;background:transparent;cursor:pointer}.ampstart-headerbar *{z-index:200}@font-face{font-family:raleway;font-style:normal;font-weight:300;src:local(),url(https://blog.networkchallenge.de/fonts/raleway-v28-latin-300.woff2) format('woff2'),url(https://blog.networkchallenge.de/fonts/raleway-v28-latin-300.woff) format('woff')}@font-face{font-family:raleway;font-style:normal;font-weight:400;src:local(),url(https://blog.networkchallenge.de/fonts/raleway-v28-latin-regular.woff2) format('woff2'),url(https://blog.networkchallenge.de/fonts/raleway-v28-latin-regular.woff) format('woff')}@font-face{font-family:raleway;font-style:normal;font-weight:600;src:local(),url(https://blog.networkchallenge.de/fonts/raleway-v28-latin-600.woff2) format('woff2'),url(https://blog.networkchallenge.de/fonts/raleway-v28-latin-600.woff) format('woff')}.intro-header {
    background-image: url('https://imgs.networkchallenge.de/400x/home-bg.jpg');
}
@media only screen and (min-width:401px){.intro-header {
    background-image: url('https://imgs.networkchallenge.de/800x/home-bg.jpg');
}}
@media only screen and (min-width:801px){.intro-header {
    background-image: url('https://imgs.networkchallenge.de/1600x/home-bg.jpg');
}}
@media only screen and (min-width:1601px){.intro-header {
    background-image: url('https://imgs.networkchallenge.de/2100x/home-bg.jpg');
}}
@media only screen and (min-width:2101px){.intro-header {
    background-image: url('https://imgs.networkchallenge.de/3200x/home-bg.jpg');
}}</style>
        <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
        
        <link rel="canonical" href="https://blog.networkchallenge.de/tech/google-cloud-run-ausprobiert/">
        <title>Google Cloud Run ausprobiert -- ChaosBlog</title>
            
            <script type="application/ld+json">
              
                
                
              
                {
                  "@context": "http://schema.org",
                  "@graph": [
                    {
                      "@type": "BlogPosting",
                      "mainEntityOfPage": {
                        "@type": "Blog",
                        "@id": "https://blog.networkchallenge.de/"
                      },
                      "headline": "Google Cloud Run ausprobiert",
                      "datePublished": "2019-04-19T20:50&#43;1200",
                      "dateModified": "2019-04-19T20:50&#43;1200 ",
                      "author": {
                        "@type": "Person",
                        "name": "Andreas Groll"
                      },
                       "publisher": {
                        "@type": "Organization",
                        "name": "ChaosBlog",
                        "logo": {
                          "@type": "ImageObject",
                          "url": "https://blog.networkchallenge.de/img/chaosblog.png "
                        }
                      },
                      "description": "Auf der Cloud Next 2019 wurde Cloud Run vorgestellt: Container starten erst bei einem Aufruf und man bezahlt nur für die Dauer des Requests. Meine Erfahrungen.",
                      "image": 
                        "https://imgs.networkchallenge.de/1600x/home-bg.jpg"
                    },
                    {
                      "@type": "BreadcrumbList",
                      "itemListElement":
                      [{
  "@type": "ListItem",
  "position":1,
  "item":
  {
   "@id": "https://blog.networkchallenge.de/",
   "name": "ChaosBlog"
   }
 },{
  "@type": "ListItem",
  "position":2,
  "item":
  {
   "@id": "https://blog.networkchallenge.de/tech/",
   "name": "Tech"
   }
 },{
  "@type": "ListItem",
  "position":3,
  "item":
  {
   "@id": "https://blog.networkchallenge.de/tech/google-cloud-run-ausprobiert/",
   "name": "Google Cloud Run ausprobiert"
   }
 }]
                    }
                  ]
                }
                </script>
            
        
<meta property="og:url"                content="https://blog.networkchallenge.de/tech/google-cloud-run-ausprobiert/" />

<meta property="og:type"               content="website" />
<meta property="og:title"              content="Google Cloud Run ausprobiert" />
<meta property="og:description"        content="Auf der Cloud Next 2019 wurde Cloud Run vorgestellt: Container starten erst bei einem Aufruf und man bezahlt nur für die Dauer des Requests. Meine Erfahrungen." />
</head>
    <body><amp-analytics data-block-on-consent="_till_accepted" type="gtag" data-credentials="include">
            <script type="application/json">
            {
                "vars" : {
                    "gtag_id": "UA-259583-6",
                    "config" : {
                        "UA-259583-6": { "groups": "default" }
                    }
                },
                "triggers": {
                    "openLightbox": {
                        "on": "click",
                        "selector": "article figure img",
                        "vars": {
                        "event_category": "photos",
                        "event_name": "openLightbox"
                        }
                    },
                    "clickLinkInternal": {
                        "on": "click",
                        "selector": "article a[href^='/'], article a[href^='https://blog.networkchallenge.de']",
                        "vars": {
                        "event_category": "link",
                        "event_name": "clickLinkInArticleInternal"
                        }
                    },
                    "clickLinkExternal": {
                        "on": "click",
                        "selector": "article a[href^='http']:not([href*='blog.networkchallenge.de'])",
                        "vars": {
                        "event_category": "link",
                        "event_name": "clickLinkInArticleExternal"
                        }
                    }
                }
            }
        </script>
        </amp-analytics>
<header class="ampstart-headerbar fixed flex justify-start items-center top-0 left-0 right-0 pl2 pr4">
        <div role="button" on="tap:AMP.setState({mainmenuopen: !mainmenuopen})" tabindex="0" class="ampstart-navbar-trigger md-hide lg-hide pr2">☰</div>
        <a href="https://blog.networkchallenge.de/">ChaosBlog</a>
        <nav class="ampstart-headerbar-nav ampstart-nav xs-hide sm-hide">
          <ul class="list-reset right m0 p0 flex justify-center nowrap"><li class="ampstart-nav-item relative dropdown">
                        <span class="dropbtn">Länder 
                                <i class="fa fa-caret-down"></i>
                        </span>
                        <div class="dropdown-content">
                                <ul class="ampstart-dropdown-items list-reset m0 p0"><li class="ampstart-nav-item">
                                      <a href="/reise/land/argentinien/" class="text-decoration-none">Argentinien</a>
                                    </li><li class="ampstart-nav-item">
                                      <a href="/reise/land/australien/" class="text-decoration-none">Australien</a>
                                    </li><li class="ampstart-nav-item">
                                      <a href="/reise/land/chile/" class="text-decoration-none">Chile</a>
                                    </li><li class="ampstart-nav-item">
                                      <a href="/reise/land/neuseeland/" class="text-decoration-none">Neuseeland</a>
                                    </li></ul>
                        </div>
                              
                      
                            </li><li class="ampstart-nav-item ">
                  <a href="/rtw/" class="text-decoration-none block">Weltreise</a>
              </li><li class="ampstart-nav-item ">
                  <a href="/about/" class="text-decoration-none block">Über</a>
              </li><li class="ampstart-nav-item ">
                  <a href="/archiv/" class="text-decoration-none block">Archiv</a>
              </li></ul>
        </nav>
        <nav id="topnav" class="ampstart-headerbar-nav ampstart-nav md-hide lg-hide" [class]="mainmenuopen ? 'topnav menuopen' : 'ampstart-headerbar-nav ampstart-nav md-hide lg-hide'">
          <ul class="burger-menu-items"><li class="ampstart-nav-item dropdown relative mt1">
                        <label>Länder 
                                <i class="fa fa-caret-down"></i>
                        </label>
                        <input class="burger-menu-item-trigger" type="checkbox" aria-label="Länder">
                                <ul class="ampstart-dropdown-items list-reset m0 ml1 p0"><li class="ampstart-nav-item mt1">
                                      <a href="/reise/land/argentinien/" class="text-decoration-none">Argentinien</a>
                                    </li><li class="ampstart-nav-item mt1">
                                      <a href="/reise/land/australien/" class="text-decoration-none">Australien</a>
                                    </li><li class="ampstart-nav-item mt1">
                                      <a href="/reise/land/chile/" class="text-decoration-none">Chile</a>
                                    </li><li class="ampstart-nav-item mt1">
                                      <a href="/reise/land/neuseeland/" class="text-decoration-none">Neuseeland</a>
                                    </li></ul>
                              
                      
                            </li><li class="ampstart-nav-item mt1">
                  <a href="/rtw/" class="text-decoration-none block">Weltreise</a>
              </li><li class="ampstart-nav-item mt1">
                  <a href="/about/" class="text-decoration-none block">Über</a>
              </li><li class="ampstart-nav-item mt1">
                  <a href="/archiv/" class="text-decoration-none block">Archiv</a>
              </li></ul>
        </nav>
      </header>
       
      
      


    <div class="intro-header lazyload">
        <div class="header-bg">
            <div class="clearfix">
                <div class="sm-col-12 md-col-9 mx-auto">
                            <div class="page-heading center">
                                <div class="title p2 left-align">
                        <h1 class="ampstart-fullpage-hero-heading mb1 mt0">
                                Google Cloud Run ausprobiert
                        </h1>
                        
<div class="clearfix">
    <div class="fit">
            
            Von <a href="#author">Andreas Groll</a>
 <br>
            
    </div>
    <div class="col mr2"><i class="fa fa-calendar" aria-hidden="true"></i> 19. Apr 2019</div><div class="col mr2"><i class="fa fa-clock-o" aria-hidden="true"></i> ca. 10 Minuten</div><div class="col mr2"><i class="fa fa-folder-o" aria-hidden="true"></i>
    <a href="https://blog.networkchallenge.de/tech/">tech</a>
  </div>

    <div class="col mr2"><i class="fa fa-tags" aria-hidden="true"></i> <a href="https://blog.networkchallenge.de/tags/devops/">devops</a>, <a href="https://blog.networkchallenge.de/tags/docker/">docker</a>, <a href="https://blog.networkchallenge.de/tags/serverless/">serverless</a>, <a href="https://blog.networkchallenge.de/tags/gcp/">gcp</a>, <a href="https://blog.networkchallenge.de/tags/graalvm/">graalvm</a>, <a href="https://blog.networkchallenge.de/tags/spring/">spring</a>, <a href="https://blog.networkchallenge.de/tags/aws/">aws</a>, <a href="https://blog.networkchallenge.de/tags/tutorial/">tutorial</a>
</div> 
    
</div>

                        <hr class="small">
                    
                            Auf der Cloud Next 2019 wurde Cloud Run vorgestellt: Container starten erst bei einem Aufruf und man bezahlt nur für die Dauer des Requests. Meine Erfahrungen.
                    
                                </div>
                            </div>
                </div>
            </div>
       </div>
    </div>

<div class="clearfix" id="content">
        <div class="contentwrapper relative">

        
        <div class="content relative">
          
          <article>
          

<h2 id="abstract">Abstract</h2>

<p>Ich befasse mich mit einem Java-Microservice, welches bei <em>Google Cloud Run</em> deployed wird und betrachte es als Alternative zu <em>AWS Lambda</em>. Dabei gehe ich auch auf das Thema Kaltstartzeit der Container ein und befasse mich in diesem Kontext auch mit den Vorteilen der <em>GraalVM</em>.</p>

<h2 id="google-cloud-next-2019">Google Cloud Next 2019</h2>

<p>Dieses Jahr hat Google auf der eigenen Cloud-Messe <em>Cloud Next</em> wieder einige interessante Dinge vorgestellt, darunter <em>Google Cloud Run</em>. <em>Cloud Run</em> ermöglicht den Betrieb von Containern als HTTP-Endpunkte nur für die Zeit eines Requests. Daraus leitet Google auch den Preis ab: es wird in 100ms Intervallen abgerechnet, jenachdem wie lang ein Request tatsächlich braucht. Google stellt damit eine einfache Möglichkeit zur Verfügung, überall gleich laufende Container in der Cloud zu geringen Kosten zu betreiben und positioniert sich in meinen Augen als (einfache?) Alternative zu <em>AWS Lambda</em>. Wie es sich schlägt, werde ich versuchen hier am Beispiel zu skizzieren.</p>

<h2 id="voraussetzungen">Voraussetzungen</h2>

<p>Um die folgenden Schritte nachvollziehen zu können braucht man folgendes:</p>

<ol>
<li>ein <em>Google Cloud Platform</em>-Konto (GCP)</li>
<li>ein neues GCP-Projekt, in dem die Umgebung aufgebaut wird</li>
<li>ein funktionierendes Abrechnungskonto, Anleitung in der <a href="https://cloud.google.com/run/docs/quickstarts/build-and-deploy#before-you-begin">Doku</a></li>
<li>ein eingerichtetes <a href="https://cloud.google.com/sdk/">Cloud SDK</a></li>
<li>eine installierte <em>gcloud beta component</em> laut <a href="https://cloud.google.com/run/docs/quickstarts/build-and-deploy">Doku</a>, siehe <code>gcloud components install beta</code></li>
<li>optional: ein GitHub-Repo-Fork von <a href="https://github.com/adulescentulus/gcloud-run-examples">gcloud-run-examples</a>, um die Docker-Images zu bauen</li>
</ol>

<h2 id="betrieb-eines-spring-boot-containers">Betrieb eines Spring Boot Containers</h2>

<h3 id="lokale-entwicklung-test">Lokale Entwicklung / Test</h3>

<p>Für den Test habe ich mir das <a href="https://spring.io/guides/gs/rest-service/">Spring Boot Greeting Service</a> genommen. Dieses ist in meinem Beispiel-Repo <a href="https://github.com/adulescentulus/gcloud-run-examples">gcloud-run-examples</a> im Ordner <code>spring</code> zu finden. Dies habe ich um ein <code>Dockerfile</code> erweitert, welches zuerst das JAR mittels Maven baut. Im gleichen <code>Dockerfile</code> wird mittels <a href="https://docs.docker.com/develop/develop-images/multistage-build/">multi-stage builds</a> das fertige JAR mit seinen Libs in ein minimales OpenJDK-Alpine-Image kopiert. Im Project-Root reicht also folgender Docker-Befehl lokal, um das Anwendungs-Image zu erstellen:</p>

<pre><code>docker build -t grolland/greeting-spring .
</code></pre>

<p>Danach steht das Image zur Verfügung und der Container kann live gestartet werden:</p>

<pre><code>docker run --rm -it -p 8080:8080 grolland/greeting-spring
</code></pre>

<p>Ein einfacher Aufruf von <a href="http://localhost:8080/greeting">http://localhost:8080/greeting</a> sollte eine Begrüßung im JSON-Format ausgeben.</p>

<pre><code>{&quot;id&quot;:1,&quot;content&quot;:&quot;Hello, World!&quot;}
</code></pre>

<h3 id="google-cloud-build">Google Cloud Build</h3>

<p>Damit <em>Cloud Run</em> einen Container starten kann, muss erstmal ein Image dafür existieren. Im vorherigen Schritt haben wir dies nur lokal erzeugt. Man kann das lokale Image zum Beispiel im <em>Docker Hub</em> hochladen. Google bietet aber mit <em>Cloud Build</em> einen Dienst an, um dies alles vollautomatisch im GCP-Umfeld zu erledigen. Das schöne: aktuell hat man täglich 120 Minuten kostenlose Build-Zeit.</p>

<p>In der GCP Console wechselt man also auf <em>Cloud Build</em> und legt einen neuen Trigger an. Dieser sorgt dafür, dass bei jeder Code-Änderung ein neues Build angestoßen wird. Nach der Auswahl von GitHub als Quelle müsst ihr den Zugriff auf euer GitHub-Konto authorisieren. Danach wählt ihr das Repo &ldquo;gcloud-run-examples&rdquo; aus. Im Konfigurationsdialog sollte folgendes konfiguriert sein:</p>

<div style="overflow-x:auto;padding-left:2px;padding-right:2px;">
<table>
<thead>
<tr>
<th>Feld</th>
<th>Wert</th>
<th>Beschreibung</th>
</tr>
</thead>

<tbody>
<tr>
<td>Name</td>
<td>Spring: Push to master</td>
<td></td>
</tr>

<tr>
<td>Trigger type</td>
<td>Branch</td>
<td></td>
</tr>

<tr>
<td>Branch (Regex)</td>
<td>master</td>
<td></td>
</tr>

<tr>
<td>Included files filter (glob)</td>
<td>spring/*</td>
<td>Nur Änderungen in diesem Verzeichnis beobachten</td>
</tr>

<tr>
<td>Build configuration</td>
<td>Dockerfile</td>
<td></td>
</tr>

<tr>
<td>Dockerfile directory</td>
<td>/spring/</td>
<td>Quellverzeichnis für Image</td>
</tr>

<tr>
<td>Image name</td>
<td>gcr.io/###deine-projectid###/gcloud-run-examples/spring:$SHORT_SHA</td>
<td>das kann beliebig gewählt werden</td>
</tr>

<tr>
<td>Timeout</td>
<td>300</td>
<td></td>
</tr>
</tbody>
</table>

</div>


<div style="max-width: 1498px;" class="imgwrapper">   
<figure>
    <amp-img lightbox="postgallery" src="https://imgs.networkchallenge.de/screenshots/gcp_build_triggers.png" 
        layout="responsive" width="1498"
        height="446" alt="Übersicht der Build Trigger"
        >
    </amp-img>
    
    <figcaption class="image">
        Übersicht der Build Trigger
    </figcaption>
    
</figure>
</div> 


<p>In der Trigger-Übersicht sollte jetzt der Trigger stehen. Dieser wird bei einem Commit getriggert oder man löst ihn manuell mit &ldquo;Run trigger&rdquo; aus. In der <em>Cloud Build</em> History im linken Menü sollte nach wenigen Minuten ein erfolgreiches Build stehen und einem fertigen Image-Namen, wie z.B. <code>gcr.io/gcloud-example-237604/gcloud-run-examples/spring:22d667f</code></p>


<div style="max-width: 2410px;" class="imgwrapper">   
<figure>
    <amp-img lightbox="postgallery" src="https://imgs.networkchallenge.de/screenshots/gcp_build_history.png" 
        layout="responsive" width="2410"
        height="418" alt="Ergebnis eines erfolgreichen Builds"
        >
    </amp-img>
    
    <figcaption class="image">
        Ergebnis eines erfolgreichen Builds
    </figcaption>
    
</figure>
</div> 


<h3 id="google-cloud-run-deployment">Google Cloud Run Deployment</h3>

<p>Jetzt haben wir ein Docker-Image welches mit <em>Cloud Run</em> instanziert werden kann. Den im vorherigen Schritt erzeugten Imagenamen müssen wir kopieren, um dieses nun zu referenzieren. Einfachheitshalber kann man das nun mit einem einzigen Befehl des SDK in <em>Cloud Run</em> deployen:</p>

<pre><code>gcloud beta run deploy gcloud-example-spring --image gcr.io/hier-der-vollständige-image-name --concurrency=default --allow-unauthenticated --memory=256Mi --set-env-vars=MaxRAM=256m
</code></pre>

<p>Dieser Einzeiler erzeugt einen neuen Service mit Namen &ldquo;gcloud-example-spring&rdquo;, der in einem Container mit 256 MB RAM bereitgestellt wird. Die zusätzliche Umgebungsvariable sagt der JVM, wieviel RAM zur Verfügung steht. Dies ist ein bekannter <a href="https://cloud.google.com/run/docs/issues#java">Issue</a> bei Google und betrifft das bekannte <a href="https://blogs.oracle.com/java-platform-group/java-se-support-for-docker-cpu-and-memory-limits">Java Container Problem</a>.</p>

<p>Die Ausführung des Befehls erzeugt noch eine Nachfrage, in welcher Region der Dienst deployed werden soll. Dies kann per Kommandozeile eigentlich angeben werden, ermöglicht aber später neu hinzugekommene Regionen leicht zu erkennen. Aktuell wird nur <em>us-central1</em> unterstützt.</p>

<p>Nach kurzer Zeit wird die Kommandozeile eine Adresse ausgeben, wo der Service nun zu finden ist. Ruft man jetzt diese URL auf, so erhalten wir unsere erwartete Antwort:</p>

<pre><code class="language-sh">time curl https://gcloud-example-spring-zufallsid-uc.a.run.app/greeting
{&quot;id&quot;:1,&quot;content&quot;:&quot;Hello, World!&quot;}
real	0m16.808s
</code></pre>

<p>Wiederholt man nun den Aufruf des Webservice, dann ergeben sich Antwortzeiten von wenigen Millisekunden, da der Container und damit die Java-Anwendung bereits initialisiert ist. Man muss dazu sagen, dass ich die Tests aus einer VM im gleichen Rechenzentrum in <em>us-central1</em> gemacht habe. Aus Deutschland dauern die Anfragen über den großen Teich entsprechend länger.</p>

<p>In der <em>GCP</em> Console im Menü unter <em>Cloud Run</em> sieht man den eben deployten Service und kann auch dort die Logs einsehen. Bei dem ersten Start sieht man die Meldungen von Spring Boot und auch die unglaubliche Initialisierungszeit:</p>

<pre><code>[ main] hello.Application : Started Application in 11.667 seconds (JVM running for 15.434)
</code></pre>

<p>Dies kann man für den ersten Versuch hinnehmen, denn anhand der vorgestellten Schritte kan man ganz einfach ein Cloud-Microservice deployen, welches man aufgrund der Docker-Basis überall laufen lassen und einfach migrieren kann. Wer sich damit nicht zufrieden geben will, der fragt sich bestimmt: <strong>Geht das nicht schneller?</strong></p>

<p>Eine mögliche Lösung beschreibe ich im nächsten Abschnitt.</p>

<h2 id="quarkus-framework-als-graalvm-native-application">Quarkus-Framework als GraalVM Native Application</h2>

<h3 id="schnelleinstieg">Schnelleinstieg</h3>

<p>Ohne mich zu lang damit aufzuhalten möchte ich nur kurz schildern, wie ich auf diese Kombination kam. Während des Lesens von IT-/DevOps-News ist mir vor kurzem <a href="https://www.heise.de/developer/meldung/Java-Framework-Quarkus-Red-Hat-vereint-reaktive-und-imperative-Programmierung-4328905.html">der Artikel bei Heise</a> über <em>Quarkus</em> über den Weg gelaufen und &ldquo;meine&rdquo; Themen FaaS, Kubernetes und Cloud-native sind in dem Fall erwähnt worden. Daher habe ich mich im Zuge der Einführung von <em>Cloud Run</em> damit beschäftigt und einige Themen sind schon sehr interessant:</p>

<ul>
<li><strong>Hot Deploy</strong> von Code-Änderungen in der Entwicklung: ein einfaches <code>mvn quarkus:dev</code> startet den Server und setzt Code-Änderungen ohne Neustart um</li>
<li>In Verbindung mit <strong>GraalVM</strong> wird der Code <em>vorcompiliert</em> und optimiert, dies führt als sogenannte <em>Native Application</em> zu extrem geringen Startzeiten</li>
</ul>

<h3 id="lokale-entwicklung-test-1">Lokale Entwicklung / Test</h3>

<p>Mein Beispiel basiert wieder auf einem <a href="https://quarkus.io/guides/spring-di-guide">offiziellen Beispiel</a>. Es befindet sich im Beispiel-Repo im Unterordner <code>quarkus-di</code> und benutzt ebenfalls Spring-Dependency-Injection.</p>

<p>Die Entwicklung einer Quarkus-Anwendung bringt, wie schon erwähnt, einen Vorteil: <em>hot code deploy</em> bei der lokalen Entwicklung mittels <code>mvn quarkus:dev</code>. Um am Ende eine Native Application zu erstellen, führt man <code>mvn package -Pnative</code> aus, um für das aktuelle OS eine native Anwendung zu erstellen. Mit unserem Ziel Docker muss diese Anwendung eine 64Bit Linux Executable sein. Dies alles wird in dem beigefügten <code>Dockerfile</code> gemacht und wie schon im Spring-Beispiel zuvor reicht ein Docker-Befehl, um das Image zu bauen und zu starten:</p>

<pre><code>docker build -t grolland/greeting-quarkus-di .
docker run --rm -it -p 8080:8080 grolland/greeting-quarkus-di
</code></pre>

<p>Das <code>Dockerfile</code> basiert für das Maven-Build auf dem Image <code>grolland/quarkus-mvn-static:graalvm-1.0.0-rc15</code>, welches ich auf Basis der <a href="https://github.com/quarkusio/quarkus-images/tree/graalvm-1.0.0-rc14/centos-quarkus-maven">Beispiele</a> um statische Bibliotheken von <em>glibc</em> und <em>zlib</em> <a href="https://github.com/adulescentulus/quarkus-images/commit/471981ddb1fd5fe283537a64bfb9bf4b0b784844">erweitert</a> habe, damit die Native Application auch im minimalen Alpine-Umfeld funktioniert.</p>

<h3 id="google-cloud-build-1">Google Cloud Build</h3>

<p>Um ein Image in der <em>GCP</em> zu bauen nehmen wir wieder <em>Cloud Build</em> und erstellen einen weiteren Trigger:</p>

<div style="overflow-x:auto;padding-left:2px;padding-right:2px;">
<table>
<thead>
<tr>
<th>Feld</th>
<th>Wert</th>
<th>Beschreibung</th>
</tr>
</thead>

<tbody>
<tr>
<td>Name</td>
<td>Quarkus-di: Push to master</td>
<td></td>
</tr>

<tr>
<td>Trigger type</td>
<td>Branch</td>
<td></td>
</tr>

<tr>
<td>Branch (Regex)</td>
<td>master</td>
<td></td>
</tr>

<tr>
<td>Included files filter (glob)</td>
<td>quarkus-di/*</td>
<td>Nur Änderungen in diesem Verzeichnis beobachten</td>
</tr>

<tr>
<td>Build configuration</td>
<td>Dockerfile</td>
<td></td>
</tr>

<tr>
<td>Dockerfile directory</td>
<td>/quarkus-di/</td>
<td>Quellverzeichnis für Image</td>
</tr>

<tr>
<td>Image name</td>
<td>gcr.io/###deine-projectid###/gcloud-run-examples/quarkus-di:$SHORT_SHA</td>
<td>das kann beliebig gewählt werden</td>
</tr>

<tr>
<td>Timeout</td>
<td>600</td>
<td></td>
</tr>
</tbody>
</table>

</div>

<p>Wichtig ist der hohe Timeout, da durch den Precompile-Prozess die Erstellung einer Native Application ungleich länger dauert als ein einfaches JAR.</p>

<p>Nach dem erfolgten Build sollte ein neues Image bereitstehen, welches wir im nächsten Schritt deployen werden.</p>

<h3 id="google-cloud-run-deployment-1">Google Cloud Run Deployment</h3>

<p>Mit dem <em>Cloud SDK</em> stoßen wir nun ein Deployment unseres zweiten Service an:</p>

<pre><code>gcloud beta run deploy gcloud-example-quarkus-di --image gcr.io/hier-der-vollständige-image-name --concurrency=default --allow-unauthenticated --memory=128Mi --set-env-vars=XMX=90m
</code></pre>

<p>Kurze Zeit später steht eine neuer Endpunkt zur Verfügung und ein Aufruf des Endpunkts sollte erfolgreich sein.</p>

<pre><code>time curl https://gcloud-example-quarkus-di-zufallsid-uc.a.run.app/greeting
{&quot;content&quot;:&quot;HELLO WORLD!&quot;,&quot;id&quot;:0}
real	0m2.720s
</code></pre>

<p>Das Ergebnis finde ich überragend. Wir haben für die Cold Start Zeitspanne eine Reduktion von ursprünglich 16 Sekunden auf knapp unter 3 Sekunden erreicht. Interessanterweise zeigt das Log unseres Service eine Initialisierungszeit für Quarkus von 166 ms an:</p>

<pre><code>INFO [io.quarkus] (main) Quarkus 0.11.0 started in 0.166s. Listening on: http://0.0.0.0:8080
</code></pre>

<p>Daraus schließe ich, dass das Deployment des laufenden Containers bei Google (natürlich) auch eine gewisse Zeit dauert. Völlig überrascht war ich, dass die Cold Start Time bei meinen Tests an verschiedenen Tagen nur manchmal vorzufinden war, das heißt nach einem Tag hatte ich manchmal das Glück, dass mein Container noch lief und kein Cold Start stattfand.</p>


<div style="max-width: 2062px;" class="imgwrapper">   
<figure>
    <amp-img lightbox="postgallery" src="https://imgs.networkchallenge.de/screenshots/gcp_run_logs.png" 
        layout="responsive" width="2062"
        height="472" alt="Logausgaben unseres Microservice in der GCP Console"
        >
    </amp-img>
    
    <figcaption class="image">
        Logausgaben unseres Microservice in der GCP Console
    </figcaption>
    
</figure>
</div> 


<p>Der aufmerksame Leser wird auch die unterschiedliche Befehlszeile erkannt habe, in der ich dem Container 128 MB RAM gebe und der Anwendung selbst bis zu 90 MB Heap Memory. Dies hat soweit bei meinen Tests funktioniert und sollte je nach Anwendung auch gezielt optimiert werden. Im Vergleich zu unserem Spring Boot Container haben wir hier aber tatsächlich nur den halben Speicher benutzt. Die Spring Boot Version startet mit 128 MB erst garnicht.</p>

<h2 id="vergleich-zu-aws-lambda">Vergleich zu AWS Lambda</h2>

<p>Ich habe bisher einige kleine private Projekte mittels <em>AWS Lambda</em> umgesetzt, dazu gehören die <a href="https://github.com/adulescentulus/serverless-image-resizing">dynamischen Bildgrößen</a> und das <a href="https://github.com/adulescentulus/inreach-mail-tracker">Location Tracking</a> auf der <a href="/rtw/">Karte</a> hier im Blog. Allen Projekten gemein war, dass ohne eine Standardimplementierung mit erzeugten Code-Templates, API-Gateway-Definitionen und Cloudformation-Templates alles ein Krampf war. Auch Kollegen, die sich mit dem Thema befasst haben, fanden den Einstieg nicht intuitiv. Dies wird dann noch durch die schwierige Testbarkeit vorsichtig formuliert &ldquo;holprig&rdquo;, obwohl es mittlerweile mit <a href="https://github.com/awslabs/aws-sam-cli">AWS SAM CLI</a> einen Lösungsansatz gibt.</p>

<p>Anhand meiner Beispiele war es hoffentlich nachvollziehbar, dass die Entwicklung eines einfachen Microservice nur aus sehr wenigen Schritten besteht, die sich gut in Templates verpacken lassen. Hier kann sich der Entwickler tatsächlich mit seinem Code beschäftigen und braucht keine AWS-Ausbildung.</p>

<p>Zu Gute halten muss man <em>AWS Lambda</em> aber trotzdem die strenge Trennung der Schichten, d.h. das API-Gateway muss immer (mehr oder weniger) implementiert werden. Während meiner Recherchen zu diesem Artikel hat A Cloud Guru auch einen <a href="https://read.acloud.guru/the-good-and-the-bad-of-google-cloud-run-34455e673ef5">Artikel</a> zu <em>Cloud Run</em> veröffentlicht und gut herausgearbeitet, dass durch das API-Gateway die Schnittstelle zum Microservice klar definiert werden kann und der eigene Service sich nicht mit Validierung vom Input beschäftigen muss. Ebenso kann sich das API-Gateway um (auch externe) Authentifzierung kümmern.</p>

<p>Aus meiner persönlichen Erfahrung muss ich aber auch hier wieder den hohen Anfangsaufwand für die Implementierung in die Argumentation bringen. Meine letzten Microservices bei <em>AWS Lambda</em> hatten eine API-Gateway-Konfiguration vom Typ <code>aws_proxy</code>, wo alle Requests einfach ohne Vorbehandlung zum Microservice weitergeleitet werden. Und habe ich schon die Probleme beim lokalen Test erwähnt &hellip;?</p>

<p>Kommen wir zu einem eher rationalen Vergleich: den Kosten. <em>AWS</em> verlangt für 1 GB Arbeitsspeicher im kleinsten Abrechnungsintervall von 100 ms 0,000001667 USD, die Kosten steigen mit dem Arbeitsspeicher linear an. Pro Million Anfragen werden noch 0,20 USD berechnet. Dazu kommt noch das API-Gateway, welches pro Million Aufrufe 3,50 USD kostet. Rechnet man alles zusammen beläuft sich das auf 0,000005167 USD pro Request. Das API-Gateway macht einen vergleichsweise hohen Anteil aus.</p>

<p>Bei Google bekommt man immer eine vCPU für den Container zugeteilt. Das macht pro 100 ms für die vCPU 0,00000240 USD. Dazu kommt der Arbeitsspeicher mit 0,00000025 USD pro Gigabyte in dem Zeitfenster. Pro Million Requests werden bei Google 0,40 USD fällig, ein API-Gateway braucht es nicht. Dies summiert sich auf 0,00000305 USD pro 100 ms.</p>

<p>Wenn man also rein die kurzlebigen Requests bis zu 100 ms Laufzeit betrachtet, ist Google aktuell 40% günstiger pro Request. Etwas wichtiges fehlt dabei noch: Im Vergleich zu <em>AWS Lambda</em> kann <em>Cloud Run</em> <strong>parallele Anfragen</strong> durch eine Instanz bearbeiten, das heißt die CPU/RAM-Preise werden nicht für jeden Request separat berechnet, sondern eine Gesamtausführungszeit vom Beginn des ersten Requests bis zum Ende des letzten Requests in Rechnung gestellt. Dies kann zu erheblichen Einsparungen führen, aber auch zu eventuellen Concurrency-Problemen (Entwicklerverantwortung), die schon A Cloud Guru im o.g. Artikel festgestellt hat.</p>

<h2 id="fazit">Fazit</h2>

<p>Grundsätzlich kann ich ein positives Fazit ziehen. <em>Cloud Run</em> liefert schon in dieser Beta eine wunderbar flexible Alternative zu <em>AWS Lambda</em>. Sicherlich hätte ich mich noch mit den <em>Cloud Functions</em> beschäftigen können, aber das Angebot als Container-as-a-Service ist aus Entwicklersicht einfach zu benutzen und dazu noch kosteneffizient. Je nach Projekt und damit auch Anforderung kann das anders aussehen.</p>

<p>Gleichzeitig gibt es aber noch das Problem, dass sich der Arbeitsspeicher nicht für den Container bemerkbar macht und somit manuelle Workarounds (die Umgebungsvariablen <code>MaxRAM</code> und <code>XMX</code> in den Beispielen) notwendig sind. Das wird hoffentlich in der Beta-Phase behoben.</p>

<p>Dies war nur eine kurze Betrachtung und ich hoffe jemand zieht daraus einen Mehrwert. Ich werde auch demnächst versuchen, die Integration in einen Kubernetes-Cluster zu testen. Dies ist ein spannender Punkt, den Google bei der Vorstellung stark hervorgehoben hat.</p>
</article>

          <hr>
          <amp-ad media="(min-width:64.06rem)"
              data-block-on-consent="_till_accepted"
              layout="fixed-height"
              height="280"
              type="adsense"
              data-ad-client="ca-pub-4404883883603593"
              data-ad-slot="9740719223">
          </amp-ad>
          <amp-ad media="not all and (min-width:64.06rem)"
              data-block-on-consent="_till_accepted"
              width="100vw" height=320
              type="adsense"
              data-ad-client="ca-pub-4404883883603593"
              data-ad-slot="7221177726"
              data-auto-format="rspv"
              data-full-width>
              <div overflow></div>
          </amp-ad>
          
        </div>
            <div class="sidebar relative">
                <div class="clearfix">
                      <div class="widget border p2">
        
                        <div class="col col-12 md-col md-col-12 center title">
                              <a name="author">Erstellt von</a>
                        </div>
                          
                          <div class="col col-4 lg-col lg-col-12">
                            <div class="avatar p2 mx-auto">
                                <amp-img class="circle self-center" src="https://imgs.networkchallenge.de/200x/avatar/groll.jpg" 
                                    layout="responsive" width="200"
                                    height="200" alt="author"
                                    srcset="https://imgs.networkchallenge.de/100x/avatar/groll.jpg 100w, https://imgs.networkchallenge.de/200x/avatar/groll.jpg 200w, https://imgs.networkchallenge.de/400x/avatar/groll.jpg 400w">
                                </amp-img>
                              <p class="center">Andreas Groll</p>
                            </div>
                          </div>
                          <div class="col col-8 lg-col lg-col-12 p2">
                              <div class="col-xs-12">
                                <p>
                                  Andreas ist der Betreiber dieses Blogs. Er schreibt aktuell vermehrt über seine Weltreise und daher nur gelegentlich über IT-Themen.
                                </p>
                              </div>
                            
                                <div class="col-xs-12 mt2">
                                    
                                      <a href="https://www.instagram.com/holygrolli/"><span class="fa-stack fa-lg"><i class="fa fa-square fa-stack-2x"></i><i class="fa fa-instagram fa-stack-1x fa-inverse"></i></span></a>
                                    
                                      <a href="https://facebook.com/andreas.gro11"><span class="fa-stack fa-lg"><i class="fa fa-square fa-stack-2x"></i><i class="fa fa-facebook fa-stack-1x fa-inverse"></i></span></a>
                                    
                                      <a href="https://github.com/holygrolli"><span class="fa-stack fa-lg"><i class="fa fa-square fa-stack-2x"></i><i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a>
                                    
                                </div>
                              
                          </div>
                      </div>
                  </div>
                  <div class="clearfix">
                      <div class="widget p2 mt2">
        
                        <div class="col col-12 md-col md-col-12 center">
                            <amp-web-push
                            id="amp-web-push"
                            layout="nodisplay"
                            helper-iframe-url="https://blog.networkchallenge.de/amp-helper-frame.html?appId=4373a84e-c094-48e0-9e5e-58d81c8fc1b9"
                            permission-dialog-url="https://blog.networkchallenge.de/amp-permission-dialog.html?appId=4373a84e-c094-48e0-9e5e-58d81c8fc1b9"
                            service-worker-url="https://blog.networkchallenge.de/OneSignalSDKWorker.js?appId=4373a84e-c094-48e0-9e5e-58d81c8fc1b9"
                          ></amp-web-push>
                          
                  <amp-web-push-widget visibility="unsubscribed" layout="fixed" width="268" height="45">
                      <button class="subscribe" on="tap:amp-web-push.subscribe">
                          <i class="fa fa-bell fa-lg mr2" aria-hidden="true"></i> Neuigkeiten abonnieren!
                      </button>
                    </amp-web-push-widget>

                    
                    <amp-web-push-widget visibility="subscribed" layout="fixed" width="268" height="45">
                        <button class="unsubscribe" on="tap:amp-web-push.unsubscribe">
                            <i class="fa fa-bell-slash fa-lg mr2" aria-hidden="true"></i> Abmelden von Neuigkeiten</button>
                    </amp-web-push-widget>
                        </div>
                      </div>
                  </div>
                  
              </div>
              <div class="content relative left">
                

<amp-iframe width=600 height=140
    layout="responsive"
    sandbox="allow-scripts allow-same-origin allow-modals allow-popups allow-forms"
    resizable
    src="https://blogamp.networkchallenge.de/disqus/dsqs.html#%2ftech%2fgoogle-cloud-run-ausprobiert%2f">
    <div overflow tabindex=0 role=button aria-label="">Read more...</div>
</amp-iframe>
   


              </div>
        </div>

                  
    </div>
            
          
          <amp-geo layout="nodisplay">
              <script type="application/json">
                {
                  "ISOCountryGroups": {
                    "eu": ["preset-eea"]
                  }
                }
              </script>
            </amp-geo>
          <amp-consent id="ncCookieConsent"
          layout="nodisplay">
          <script type="application/json">
            {
              "consents": {
                "ncCookieConsent": {
                  "promptIfUnknownForGeoGroup": "eu",
                  "promptUI": "consentDialog"
                }
              }
            }
          </script>
          <div class="popupOverlay"
            id="consentDialog">
            <div class="consentPopup">
              <div class="h2 m1">Cookie-Richtlinie</div>
              <p class="m1">Diese Website benutzt Cookies, u.a. zur automatisierten Nutzerauswertung mit Google Analytics.</p>
              <p class="m1">Bitte beachten Sie die <a href="https://blog.networkchallenge.de/privacypolicy/" title="Datenschutzerklärung">Datenschutzerklärung</a>!</p>
              <button on="tap:ncCookieConsent.accept" role="button"
                class="ampstart-btn ampstart-btn-secondary caps mx1">Akzeptieren</button>
            </div>
          </div>
        </amp-consent>
  
        <hr>
        
        <footer>
            <div class="clearfix">
                    <div class="sm-col-12 md-col-9 mx-auto">
                      <ul class="list-reset flex justify-center items-center">
                        
                        
                        
                        <li>
                          <a href="https://www.instagram.com/holygrolli/">
                            <span class="fa-stack fa-lg">
                              <i class="fa fa-circle fa-stack-2x"></i>
                              <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                            </span>
                          </a>
                        </li>
                        
                        <li>
                          <a href="https://facebook.com/andreas.gro11">
                            <span class="fa-stack fa-lg">
                              <i class="fa fa-circle fa-stack-2x"></i>
                              <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                          </a>
                        </li>
                        
                        <li>
                          <a href="https://github.com/holygrolli">
                            <span class="fa-stack fa-lg">
                              <i class="fa fa-circle fa-stack-2x"></i>
                              <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                          </a>
                        </li>
                        
                      </ul>
                      <p class="center ampstart-small-text">
                        <a href="https://blog.networkchallenge.de/impressum/" title="Impressum">Impressum</a>
                        <br><a href="https://blog.networkchallenge.de/privacypolicy/" title="Datenschutzerklärung">Datenschutzerklärung</a>
                        <br>Copyright © <a href="https://blog.networkchallenge.de/about/ ">Andreas Groll</a> 2021</p>
                    </div>
            </div>
        </footer>
    </body>
</html>