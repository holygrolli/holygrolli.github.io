

<!doctype html>
<html ⚡ lang="de">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta name="description" content="Aufbau einer DevOps-Pipeline für eine Multiservice-Anwendung in Kubernetes"><link rel="preload" as="script" href="https://cdn.ampproject.org/v0.js">
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">
        
        <script async src="https://cdn.ampproject.org/v0.js"></script>

        <script async custom-element="amp-bind" src="https://cdn.ampproject.org/v0/amp-bind-0.1.js"></script>
        <script async custom-element="amp-lightbox-gallery" src="https://cdn.ampproject.org/v0/amp-lightbox-gallery-0.1.js"></script><script async custom-element="amp-carousel" src="https://cdn.ampproject.org/v0/amp-carousel-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script><script async custom-element="amp-ad" src="https://cdn.ampproject.org/v0/amp-ad-0.1.js"></script><script async custom-element="amp-consent" src="https://cdn.ampproject.org/v0/amp-consent-0.1.js"></script>
        <script async custom-element="amp-geo" src="https://cdn.ampproject.org/v0/amp-geo-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-web-push" src="https://cdn.ampproject.org/v0/amp-web-push-0.1.js"></script>
        <style amp-custom="">/*!Basscss | http://basscss.com | MIT License*/.h00{font-size:4rem;font-size:var(--h00)}.h0{font-size:3rem;font-size:var(--h0)}.h1{font-size:2rem;font-size:var(--h1)}.h2{font-size:1.5rem;font-size:var(--h2)}.h3{font-size:1.25rem;font-size:var(--h3)}.h4{font-size:1rem;font-size:var(--h4)}.h5{font-size:.875rem;font-size:var(--h5)}.h6{font-size:.75rem;font-size:var(--h6)}:root{--h00:4rem;--h0:3rem;--h1:2rem;--h2:1.5rem;--h3:1.25rem;--h4:1rem;--h5:.875rem;--h6:.75rem}.font-family-inherit{font-family:inherit}.font-size-inherit{font-size:inherit}.text-decoration-none{text-decoration:none}.bold{font-weight:700;font-weight:var(--bold-font-weight,bold)}.regular{font-weight:400}.italic{font-style:italic}.caps{text-transform:uppercase;letter-spacing:.2em;letter-spacing:var(--caps-letter-spacing)}.left-align{text-align:left}.center{text-align:center}.right-align{text-align:right}.justify{text-align:justify}.nowrap{white-space:nowrap}.break-word{word-wrap:break-word}.line-height-1{line-height:1;line-height:var(--line-height-1)}.line-height-2{line-height:1.125;line-height:var(--line-height-2)}.line-height-3{line-height:1.25;line-height:var(--line-height-3)}.line-height-4{line-height:1.5;line-height:var(--line-height-4)}.list-style-none{list-style:none}.underline{text-decoration:underline}.truncate{max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.list-reset{list-style:none;padding-left:0}:root{--line-height-1:1;--line-height-2:1.125;--line-height-3:1.25;--line-height-4:1.5;--caps-letter-spacing:.2em;--bold-font-weight:bold}.inline{display:inline}.block{display:block}.inline-block{display:inline-block}.table{display:table}.table-cell{display:table-cell}.overflow-hidden{overflow:hidden}.overflow-scroll{overflow:scroll}.overflow-auto{overflow:auto}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.left{float:left}.right{float:right}.fit{max-width:100%}.max-width-1{max-width:24rem;max-width:var(--width-1)}.max-width-2{max-width:32rem;max-width:var(--width-2)}.max-width-3{max-width:48rem;max-width:var(--width-3)}.max-width-4{max-width:64rem;max-width:var(--width-4)}.border-box{box-sizing:border-box}:root{--width-1:24rem;--width-2:32rem;--width-3:48rem;--width-4:64rem}.align-baseline{vertical-align:baseline}.align-top{vertical-align:top}.align-middle{vertical-align:middle}.align-bottom{vertical-align:bottom}.m0{margin:0}.mt0{margin-top:0}.mr0{margin-right:0}.mb0{margin-bottom:0}.ml0{margin-left:0}.mx0{margin-left:0;margin-right:0}.my0{margin-top:0;margin-bottom:0}.m1{margin:.5rem;margin:var(--space-1)}.mt1{margin-top:.5rem;margin-top:var(--space-1)}.mr1{margin-right:.5rem;margin-right:var(--space-1)}.mb1{margin-bottom:.5rem;margin-bottom:var(--space-1)}.ml1{margin-left:.5rem;margin-left:var(--space-1)}.mx1{margin-left:.5rem;margin-left:var(--space-1);margin-right:.5rem;margin-right:var(--space-1)}.my1{margin-top:.5rem;margin-top:var(--space-1);margin-bottom:.5rem;margin-bottom:var(--space-1)}.m2{margin:1rem;margin:var(--space-2)}.mt2{margin-top:1rem;margin-top:var(--space-2)}.mr2{margin-right:1rem;margin-right:var(--space-2)}.mb2{margin-bottom:1rem;margin-bottom:var(--space-2)}.ml2{margin-left:1rem;margin-left:var(--space-2)}.mx2{margin-left:1rem;margin-left:var(--space-2);margin-right:1rem;margin-right:var(--space-2)}.my2{margin-top:1rem;margin-top:var(--space-2);margin-bottom:1rem;margin-bottom:var(--space-2)}.m3{margin:2rem;margin:var(--space-3)}.mt3{margin-top:2rem;margin-top:var(--space-3)}.mr3{margin-right:2rem;margin-right:var(--space-3)}.mb3{margin-bottom:2rem;margin-bottom:var(--space-3)}.ml3{margin-left:2rem;margin-left:var(--space-3)}.mx3{margin-left:2rem;margin-left:var(--space-3);margin-right:2rem;margin-right:var(--space-3)}.my3{margin-top:2rem;margin-top:var(--space-3);margin-bottom:2rem;margin-bottom:var(--space-3)}.m4{margin:4rem;margin:var(--space-4)}.mt4{margin-top:4rem;margin-top:var(--space-4)}.mr4{margin-right:4rem;margin-right:var(--space-4)}.mb4{margin-bottom:4rem;margin-bottom:var(--space-4)}.ml4{margin-left:4rem;margin-left:var(--space-4)}.mx4{margin-left:4rem;margin-left:var(--space-4);margin-right:4rem;margin-right:var(--space-4)}.my4{margin-top:4rem;margin-top:var(--space-4);margin-bottom:4rem;margin-bottom:var(--space-4)}.mxn1{margin-left:-.5rem;margin-left:calc(var(--space-1)*-1);margin-right:-.5rem;margin-right:calc(var(--space-1)*-1)}.mxn2{margin-left:-1rem;margin-left:calc(var(--space-2)*-1);margin-right:-1rem;margin-right:calc(var(--space-2)*-1)}.mxn3{margin-left:-2rem;margin-left:calc(var(--space-3)*-1);margin-right:-2rem;margin-right:calc(var(--space-3)*-1)}.mxn4{margin-left:-4rem;margin-left:calc(var(--space-4)*-1);margin-right:-4rem;margin-right:calc(var(--space-4)*-1)}.m-auto{margin:auto}.mt-auto{margin-top:auto}.mr-auto{margin-right:auto}.mb-auto{margin-bottom:auto}.ml-auto{margin-left:auto}.mx-auto{margin-left:auto;margin-right:auto}.my-auto{margin-top:auto;margin-bottom:auto}:root{--space-1:.5rem;--space-2:1rem;--space-3:1.5rem;--space-4:2rem}.p0{padding:0}.pt0{padding-top:0}.pr0{padding-right:0}.pb0{padding-bottom:0}.pl0{padding-left:0}.px0{padding-left:0;padding-right:0}.py0{padding-top:0;padding-bottom:0}.p1{padding:.5rem;padding:var(--space-1)}.pt1{padding-top:.5rem;padding-top:var(--space-1)}.pr1{padding-right:.5rem;padding-right:var(--space-1)}.pb1{padding-bottom:.5rem;padding-bottom:var(--space-1)}.pl1{padding-left:.5rem;padding-left:var(--space-1)}.py1{padding-top:.5rem;padding-top:var(--space-1);padding-bottom:.5rem;padding-bottom:var(--space-1)}.px1{padding-left:.5rem;padding-left:var(--space-1);padding-right:.5rem;padding-right:var(--space-1)}.p2{padding:1rem;padding:var(--space-2)}.pt2{padding-top:1rem;padding-top:var(--space-2)}.pr2{padding-right:1rem;padding-right:var(--space-2)}.pb2{padding-bottom:1rem;padding-bottom:var(--space-2)}.pl2{padding-left:1rem;padding-left:var(--space-2)}.py2{padding-top:1rem;padding-top:var(--space-2);padding-bottom:1rem;padding-bottom:var(--space-2)}.px2{padding-left:1rem;padding-left:var(--space-2);padding-right:1rem;padding-right:var(--space-2)}.p3{padding:2rem;padding:var(--space-3)}.pt3{padding-top:2rem;padding-top:var(--space-3)}.pr3{padding-right:2rem;padding-right:var(--space-3)}.pb3{padding-bottom:2rem;padding-bottom:var(--space-3)}.pl3{padding-left:2rem;padding-left:var(--space-3)}.py3{padding-top:2rem;padding-top:var(--space-3);padding-bottom:2rem;padding-bottom:var(--space-3)}.px3{padding-left:2rem;padding-left:var(--space-3);padding-right:2rem;padding-right:var(--space-3)}.p4{padding:4rem;padding:var(--space-4)}.pt4{padding-top:4rem;padding-top:var(--space-4)}.pr4{padding-right:4rem;padding-right:var(--space-4)}.pb4{padding-bottom:4rem;padding-bottom:var(--space-4)}.pl4{padding-left:4rem;padding-left:var(--space-4)}.py4{padding-top:4rem;padding-top:var(--space-4);padding-bottom:4rem;padding-bottom:var(--space-4)}.px4{padding-left:4rem;padding-left:var(--space-4);padding-right:4rem;padding-right:var(--space-4)}:root{--space-1:.5rem;--space-2:1rem;--space-3:1.5rem;--space-4:2rem}.col{float:left;box-sizing:border-box}.col-right{float:right;box-sizing:border-box}.col-1{width:8.33333%}.col-2{width:16.66667%}.col-3{width:25%}.col-4{width:33.33333%}.col-5{width:41.66667%}.col-6{width:50%}.col-7{width:58.33333%}.col-8{width:66.66667%}.col-9{width:75%}.col-10{width:83.33333%}.col-11{width:91.66667%}.col-12{width:100%}@media(min-width:40em){.sm-col{float:left;box-sizing:border-box}.sm-col-right{float:right;box-sizing:border-box}.sm-col-1{width:8.33333%}.sm-col-2{width:16.66667%}.sm-col-3{width:25%}.sm-col-4{width:33.33333%}.sm-col-5{width:41.66667%}.sm-col-6{width:50%}.sm-col-7{width:58.33333%}.sm-col-8{width:66.66667%}.sm-col-9{width:75%}.sm-col-10{width:83.33333%}.sm-col-11{width:91.66667%}.sm-col-12{width:100%}}@media(min-width:52em){.md-col{float:left;box-sizing:border-box}.md-col-right{float:right;box-sizing:border-box}.md-col-1{width:8.33333%}.md-col-2{width:16.66667%}.md-col-3{width:25%}.md-col-4{width:33.33333%}.md-col-5{width:41.66667%}.md-col-6{width:50%}.md-col-7{width:58.33333%}.md-col-8{width:66.66667%}.md-col-9{width:75%}.md-col-10{width:83.33333%}.md-col-11{width:91.66667%}.md-col-12{width:100%}}@media(min-width:64em){.lg-col{float:left;box-sizing:border-box}.lg-col-right{float:right;box-sizing:border-box}.lg-col-1{width:8.33333%}.lg-col-2{width:16.66667%}.lg-col-3{width:25%}.lg-col-4{width:33.33333%}.lg-col-5{width:41.66667%}.lg-col-6{width:50%}.lg-col-7{width:58.33333%}.lg-col-8{width:66.66667%}.lg-col-9{width:75%}.lg-col-10{width:83.33333%}.lg-col-11{width:91.66667%}.lg-col-12{width:100%}}.flex{display:flex}@media(min-width:40em){.sm-flex{display:flex}}@media(min-width:52em){.md-flex{display:flex}}@media(min-width:64em){.lg-flex{display:flex}}.flex-column{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.items-baseline{align-items:baseline}.items-stretch{align-items:stretch}.self-start{align-self:flex-start}.self-end{align-self:flex-end}.self-center{align-self:center}.self-baseline{align-self:baseline}.self-stretch{align-self:stretch}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-around{justify-content:space-around}.justify-evenly{justify-content:space-evenly}.content-start{align-content:flex-start}.content-end{align-content:flex-end}.content-center{align-content:center}.content-between{align-content:space-between}.content-around{align-content:space-around}.content-stretch{align-content:stretch}.flex-auto{flex:1 1 auto;min-width:0;min-height:0}.flex-none{flex:none}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-last{order:99999}.relative{position:relative}.absolute{position:absolute}.fixed{position:fixed}.top-0{top:0}.right-0{right:0}.bottom-0{bottom:0}.left-0{left:0}.z1{z-index:1;z-index:var(--z1)}.z2{z-index:2;z-index:var(--z2)}.z3{z-index:3;z-index:var(--z3)}.z4{z-index:4;z-index:var(--z4)}:root{--z1:1;--z2:2;--z3:3;--z4:4}.border{border-style:solid;border-width:1px;border-width:var(--border-width)}.border-top{border-top-style:solid;border-top-width:1px;border-top-width:var(--border-width)}.border-right{border-right-style:solid;border-right-width:1px;border-right-width:var(--border-width)}.border-bottom{border-bottom-style:solid;border-bottom-width:1px;border-bottom-width:var(--border-width)}.border-left{border-left-style:solid;border-left-width:1px;border-left-width:var(--border-width)}.border-none{border:0}.rounded{border-radius:3px;border-radius:var(--border-radius)}.circle{border-radius:50%}.rounded-top{border-radius:3px 3px 0 0;border-radius:var(--border-radius) var(--border-radius) 0 0}.rounded-right{border-radius:0 3px 3px 0;border-radius:0 var(--border-radius) var(--border-radius) 0}.rounded-bottom{border-radius:0 0 3px 3px;border-radius:0 0 var(--border-radius) var(--border-radius)}.rounded-left{border-radius:3px 0 0 3px;border-radius:var(--border-radius) 0 0 var(--border-radius)}.not-rounded{border-radius:0}:root{--border-width:1px;--border-radius:3px}.hide{position:absolute;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px)}@media(max-width:40em){.xs-hide{display:none}}@media(min-width:40em) and (max-width:52em){.sm-hide{display:none}}@media(min-width:52em) and (max-width:64em){.md-hide{display:none}}@media(min-width:64em){.lg-hide{display:none}}.display-none{display:none}*{box-sizing:border-box}.ampstart-navbar-trigger{line-height:3.5rem;font-size:2rem}.ampstart-nav a,.ampstart-navbar-trigger,.ampstart-sidebar-faq a{cursor:pointer;text-decoration:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a,a:active,a:visited{color:inherit}.ampstart-headerbar-nav{-ms-flex:1;flex:1;line-height:3.5rem}.ampstart-headerbar-nav .ampstart-nav-item{padding:0 1rem;background:transparent;opacity:.8}.ampstart-fullpage-hero-heading{line-height:3.5rem}h1,h2,h3,h4,h5,h6{letter-spacing:.06rem}.h1,h1{font-size:3rem;line-height:3.5rem}.h2,h2{font-size:2rem;line-height:2.5rem}.h3,h3{font-size:1.5rem;line-height:2rem}.h4,h4{font-size:1.125rem;line-height:1.5rem}.h5,h5{font-size:.875rem;line-height:1.125rem}.h6,h6{font-size:.75rem;line-height:1rem}p{padding:0;margin:0}.ampstart-footer,.ampstart-small-text{font-size:.75rem;line-height:1rem;letter-spacing:.06rem}.ampstart-btn{font-family:inherit;font-weight:inherit;font-size:1rem;line-height:1.125rem;padding:.7em .8em;text-decoration:none;white-space:nowrap;word-wrap:normal;vertical-align:middle;cursor:pointer;background-color:#000;color:#fff;border:1px solid #fff}.ampstart-btn-secondary{background-color:#fff;color:#000;border:1px solid #000}figure.ampstart-image-fullpage-hero span.bgnone{background:0 0}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,courier new,monospace}code{padding:2px 4px;font-size:90%;color:#c7254e;background-color:#f9f2f4;border-radius:4px}kbd{padding:2px 4px;font-size:90%;color:#c7254e;background-color:#f9f2f4;border-radius:2px;box-shadow:inset 0 -1px 0 rgba(0,0,0,.25)}pre{display:block;line-height:1.4;font-size:13px;padding:5px;word-break:break-all;word-wrap:break-word;color:#333;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px}pre code{font-size:1em;padding:0;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0}body{font-family:amblelight,raleway,Helvetica,Arial,sans-serif;letter-spacing:.02em;font-size:20px;-webkit-tap-highlight-color:#0085a1;line-height:1.5rem;-webkit-font-smoothing:antialiased;color:#4a4a4a}header h1{font-weight:700;text-shadow:0 0 0 rgba(0,0,0,0),10px 7px 2px rgba(134,129,129,.36);text-decoration:none}.ampstart-headerbar,h1,h2,h3,h4,h5,h6{font-weight:800}h1,h2,h3,h4,h5,h6{margin-top:20px;margin-bottom:10px}a{text-decoration:none}a:focus,a:hover{color:#0085a1}article:not([class=post-preview]) a,.consentPopup a{text-decoration:underline}hr{margin-top:20px;margin-bottom:20px;border:0;border-top:1px solid #eee}hr.small{max-width:100px;margin:15px auto;border-color:#eee;border-width:4px}article p{margin:0 0 10px;line-height:1.5}blockquote{padding:10px 20px;margin:0 0 20px;font-size:17.5px;border-left:5px solid #eee;color:#777;font-style:italic}.contentwrapper{overflow:hidden}.content{float:none;width:100%;padding:0 15px}.sidebar{float:none;width:100%;padding:0 15px}.widget{overflow:hidden;font-size:80%}.border{border:1px solid #000}.widgetbg{border:1px solid #eee;background:#eee}article figure{margin:15px -15px 25px}article figcaption{padding:5px 15px;text-align:center;font-size:90%}.widget .title{font-size:120%}.ampstart-headerbar+amp-sidebar~figure.ampstart-image-fullpage-hero{margin-top:3.5rem}.intro-header .page-heading,.intro-header .post-heading,.intro-header .site-heading{padding:75px 0}.intro-header .page-heading h1,.intro-header .site-heading h1{font-size:60px}.intro-header .page-heading .title,.intro-header .site-heading .title{margin:0 2px}@media(min-width:64em){.contentwrapper{padding-right:340px;overflow:hidden}.content{float:left;width:100%;padding:0 60px}.sidebar{margin-right:-340px;padding:0 20px;width:340px;float:right}article figure{margin:0 0 25px}.intro-header .page-heading,.intro-header .post-heading,.intro-header .site-heading{padding:150px 0}.intro-header .page-heading h1,.intro-header .site-heading h1{font-size:80px}.intro-header .page-heading .title,.intro-header .site-heading .title{margin:0}}.avatar{max-width:190px}.pagination{display:inline-block;padding-left:0;margin:1rem;border-radius:2px}.pagination>li{display:inline}.pagination>li>a,.pagination>li>span{position:relative;float:left;padding:5px;line-height:1rem;text-decoration:none;color:#000;background-color:#fff;border:1px solid #000;margin-left:-1px}.pagination>li:first-child>a,.pagination>li:first-child>span{margin-left:0}.pagination>li>a:hover,.pagination>li>span:hover,.pagination>li>a:focus,.pagination>li>span:focus{z-index:2;color:#fff;background-color:#337ab7;border-color:#337ab7}.pagination>.active>a,.pagination>.active>span,.pagination>.active>a:hover,.pagination>.active>span:hover,.pagination>.active>a:focus,.pagination>.active>span:focus{z-index:3;color:#fff;background-color:#337ab7;border-color:#337ab7;cursor:default}.pagination>.disabled>a,.pagination>.disabled>span,.pagination>.disabled>a:hover,.pagination>.disabled>span:hover,.pagination>.disabled>a:focus,.pagination>.disabled>span:focus{color:#000;background-color:#fff;border-color:#337ab7;cursor:not-allowed}.intro-header{background:50% no-repeat;-webkit-background-size:cover;-moz-background-size:cover;background-size:cover;-o-background-size:cover;margin-bottom:50px;display:block}.header-bg{background:rgba(0,0,0,.2)}@media only screen and (min-width:768px){.intro-header .page-heading h1,.intro-header .site-heading h1{font-size:80px}}.intro-header .page-heading h1,.intro-header .site-heading h1{margin-top:0;font-size:50px}body>div.intro-header div.title{color:#fff;border:2px solid #fff;background:#000;background:rgba(0,0,0,.4)}.ampstart-headerbar{background-color:rgba(255,255,255,.7);color:#000;z-index:999;box-shadow:0 0 5px 2px rgba(0,0,0,.1)}amp-consent{background-color:#fff;border:1px solid red}amp-web-push-widget button.subscribe{display:inline-flex;align-items:center;border-radius:2px;border:0;box-sizing:border-box;margin:0;padding:10px 15px;cursor:pointer;outline:none;font-size:15px;font-weight:400;background:#4a90e2;color:#fff;box-shadow:0 1px 1px 0 rgba(0,0,0,.5);-webkit-tap-highlight-color:rgba(0,0,0,0)}amp-web-push-widget button.subscribe:active{transform:scale(0.99)}amp-web-push-widget button.unsubscribe{display:inline-flex;align-items:center;border-radius:2px;border:0;box-sizing:border-box;margin:0;padding:10px 15px;cursor:pointer;outline:none;font-size:15px;font-weight:400;background:#769ac3;color:#000;box-shadow:0 1px 1px 0 rgba(0,0,0,.5);-webkit-tap-highlight-color:rgba(0,0,0,0)}.imgwrapper{margin-left:auto;margin-right:auto}article table{width:100%;border-collapse:collapse;font-size:75%;margin-bottom:20px}article table td{border:1px solid gray;padding:0 5px}article table tr:nth-child(even){background:#ccc}article table tr:nth-child(odd){background:#fff}.dropdown .dropbtn{background-color:inherit;font-family:inherit}.dropdown-content{display:none;position:absolute;background-color:rgba(255,255,255,.7);min-width:160px;box-shadow:0 8px 16px 0 rgba(0,0,0,.2);z-index:1}.dropdown:hover .dropdown-content{display:block}#topnav{position:fixed;top:0;left:0;width:100vw;height:100vh;padding:40px 20px 80px;z-index:-1;background-color:#fff;pointer-events:none;opacity:0;transition:transform .2s ease,opacity .2s ease}#topnav.menuopen{z-index:100;opacity:1;pointer-events:auto}#topnav.menuopen .dropdown{float:none}#topnav.menuopen .dropdown-content{position:relative}#topnav.menuopen .dropdown .dropbtn{display:block;width:100%;text-align:left}.burger-menu-items{display:flex;flex-direction:column;height:100%;margin:0;margin-top:1rem;padding:0;overflow-y:auto}.burger-menu-items ul{display:none}.burger-menu-item-trigger:checked~ul{display:block}.burger-menu-item-trigger{position:absolute;left:0;top:0;width:100%;height:36px;padding:0;margin:0;opacity:0;background:transparent;cursor:pointer}.ampstart-headerbar *{z-index:200}@font-face{font-family:raleway;font-style:normal;font-weight:300;src:local(),url(https://blog.networkchallenge.de/fonts/raleway-v28-latin-300.woff2) format('woff2'),url(https://blog.networkchallenge.de/fonts/raleway-v28-latin-300.woff) format('woff')}@font-face{font-family:raleway;font-style:normal;font-weight:400;src:local(),url(https://blog.networkchallenge.de/fonts/raleway-v28-latin-regular.woff2) format('woff2'),url(https://blog.networkchallenge.de/fonts/raleway-v28-latin-regular.woff) format('woff')}@font-face{font-family:raleway;font-style:normal;font-weight:600;src:local(),url(https://blog.networkchallenge.de/fonts/raleway-v28-latin-600.woff2) format('woff2'),url(https://blog.networkchallenge.de/fonts/raleway-v28-latin-600.woff) format('woff')}.intro-header {
    background-image: url('https://imgs.networkchallenge.de/400x/home-bg.jpg');
}
@media only screen and (min-width:401px){.intro-header {
    background-image: url('https://imgs.networkchallenge.de/800x/home-bg.jpg');
}}
@media only screen and (min-width:801px){.intro-header {
    background-image: url('https://imgs.networkchallenge.de/1600x/home-bg.jpg');
}}
@media only screen and (min-width:1601px){.intro-header {
    background-image: url('https://imgs.networkchallenge.de/2100x/home-bg.jpg');
}}
@media only screen and (min-width:2101px){.intro-header {
    background-image: url('https://imgs.networkchallenge.de/3200x/home-bg.jpg');
}}</style>
        <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
        
        <link rel="canonical" href="https://blog.networkchallenge.de/tech/k8s-einstieg-in-canary-deployments/">
        <title>Einstieg in Canary Deployments -- ChaosBlog</title>
            
            <script type="application/ld+json">
              
                
                
              
                {
                  "@context": "http://schema.org",
                  "@graph": [
                    {
                      "@type": "BlogPosting",
                      "mainEntityOfPage": {
                        "@type": "Blog",
                        "@id": "https://blog.networkchallenge.de/"
                      },
                      "headline": "Einstieg in Canary Deployments",
                      "datePublished": "2019-08-01T16:00&#43;0800",
                      "dateModified": "2019-08-01T16:00&#43;0800 ",
                      "author": {
                        "@type": "Person",
                        "name": "Andreas Groll"
                      },
                       "publisher": {
                        "@type": "Organization",
                        "name": "ChaosBlog",
                        "logo": {
                          "@type": "ImageObject",
                          "url": "https://blog.networkchallenge.de/img/chaosblog.png "
                        }
                      },
                      "description": "Aufbau einer DevOps-Pipeline für eine Multiservice-Anwendung in Kubernetes",
                      "image": 
                        "https://imgs.networkchallenge.de/1600x/home-bg.jpg"
                    },
                    {
                      "@type": "BreadcrumbList",
                      "itemListElement":
                      [{
  "@type": "ListItem",
  "position":1,
  "item":
  {
   "@id": "https://blog.networkchallenge.de/",
   "name": "ChaosBlog"
   }
 },{
  "@type": "ListItem",
  "position":2,
  "item":
  {
   "@id": "https://blog.networkchallenge.de/tech/",
   "name": "Tech"
   }
 },{
  "@type": "ListItem",
  "position":3,
  "item":
  {
   "@id": "https://blog.networkchallenge.de/tech/k8s-einstieg-in-canary-deployments/",
   "name": "Einstieg in Canary Deployments"
   }
 }]
                    }
                  ]
                }
                </script>
            
        
<meta property="og:url"                content="https://blog.networkchallenge.de/tech/k8s-einstieg-in-canary-deployments/" />

<meta property="og:type"               content="website" />
<meta property="og:title"              content="Einstieg in Canary Deployments" />
<meta property="og:description"        content="Aufbau einer DevOps-Pipeline für eine Multiservice-Anwendung in Kubernetes" />
</head>
    <body><amp-analytics data-block-on-consent="_till_accepted" type="gtag" data-credentials="include">
            <script type="application/json">
            {
                "vars" : {
                    "gtag_id": "UA-259583-6",
                    "config" : {
                        "UA-259583-6": { "groups": "default" }
                    }
                },
                "triggers": {
                    "openLightbox": {
                        "on": "click",
                        "selector": "article figure img",
                        "vars": {
                        "event_category": "photos",
                        "event_name": "openLightbox"
                        }
                    },
                    "clickLinkInternal": {
                        "on": "click",
                        "selector": "article a[href^='/'], article a[href^='https://blog.networkchallenge.de']",
                        "vars": {
                        "event_category": "link",
                        "event_name": "clickLinkInArticleInternal"
                        }
                    },
                    "clickLinkExternal": {
                        "on": "click",
                        "selector": "article a[href^='http']:not([href*='blog.networkchallenge.de'])",
                        "vars": {
                        "event_category": "link",
                        "event_name": "clickLinkInArticleExternal"
                        }
                    }
                }
            }
        </script>
        </amp-analytics>
<header class="ampstart-headerbar fixed flex justify-start items-center top-0 left-0 right-0 pl2 pr4">
        <div role="button" on="tap:AMP.setState({mainmenuopen: !mainmenuopen})" tabindex="0" class="ampstart-navbar-trigger md-hide lg-hide pr2">☰</div>
        <a href="https://blog.networkchallenge.de/">ChaosBlog</a>
        <nav class="ampstart-headerbar-nav ampstart-nav xs-hide sm-hide">
          <ul class="list-reset right m0 p0 flex justify-center nowrap"><li class="ampstart-nav-item relative dropdown">
                        <span class="dropbtn">Länder 
                                <i class="fa fa-caret-down"></i>
                        </span>
                        <div class="dropdown-content">
                                <ul class="ampstart-dropdown-items list-reset m0 p0"><li class="ampstart-nav-item">
                                      <a href="/reise/land/argentinien/" class="text-decoration-none">Argentinien</a>
                                    </li><li class="ampstart-nav-item">
                                      <a href="/reise/land/australien/" class="text-decoration-none">Australien</a>
                                    </li><li class="ampstart-nav-item">
                                      <a href="/reise/land/chile/" class="text-decoration-none">Chile</a>
                                    </li><li class="ampstart-nav-item">
                                      <a href="/reise/land/neuseeland/" class="text-decoration-none">Neuseeland</a>
                                    </li></ul>
                        </div>
                              
                      
                            </li><li class="ampstart-nav-item ">
                  <a href="/rtw/" class="text-decoration-none block">Weltreise</a>
              </li><li class="ampstart-nav-item ">
                  <a href="/about/" class="text-decoration-none block">Über</a>
              </li><li class="ampstart-nav-item ">
                  <a href="/archiv/" class="text-decoration-none block">Archiv</a>
              </li></ul>
        </nav>
        <nav id="topnav" class="ampstart-headerbar-nav ampstart-nav md-hide lg-hide" [class]="mainmenuopen ? 'topnav menuopen' : 'ampstart-headerbar-nav ampstart-nav md-hide lg-hide'">
          <ul class="burger-menu-items"><li class="ampstart-nav-item dropdown relative mt1">
                        <label>Länder 
                                <i class="fa fa-caret-down"></i>
                        </label>
                        <input class="burger-menu-item-trigger" type="checkbox" aria-label="Länder">
                                <ul class="ampstart-dropdown-items list-reset m0 ml1 p0"><li class="ampstart-nav-item mt1">
                                      <a href="/reise/land/argentinien/" class="text-decoration-none">Argentinien</a>
                                    </li><li class="ampstart-nav-item mt1">
                                      <a href="/reise/land/australien/" class="text-decoration-none">Australien</a>
                                    </li><li class="ampstart-nav-item mt1">
                                      <a href="/reise/land/chile/" class="text-decoration-none">Chile</a>
                                    </li><li class="ampstart-nav-item mt1">
                                      <a href="/reise/land/neuseeland/" class="text-decoration-none">Neuseeland</a>
                                    </li></ul>
                              
                      
                            </li><li class="ampstart-nav-item mt1">
                  <a href="/rtw/" class="text-decoration-none block">Weltreise</a>
              </li><li class="ampstart-nav-item mt1">
                  <a href="/about/" class="text-decoration-none block">Über</a>
              </li><li class="ampstart-nav-item mt1">
                  <a href="/archiv/" class="text-decoration-none block">Archiv</a>
              </li></ul>
        </nav>
      </header>
       
      
      


    <div class="intro-header lazyload">
        <div class="header-bg">
            <div class="clearfix">
                <div class="sm-col-12 md-col-9 mx-auto">
                            <div class="page-heading center">
                                <div class="title p2 left-align">
                        <h1 class="ampstart-fullpage-hero-heading mb1 mt0">
                                Einstieg in Canary Deployments
                        </h1>
                        
<div class="clearfix">
    <div class="fit">
            
            Von <a href="#author">Andreas Groll</a>
 <br>
            
    </div>
    <div class="col mr2"><i class="fa fa-calendar" aria-hidden="true"></i> 1. Aug 2019</div><div class="col mr2"><i class="fa fa-clock-o" aria-hidden="true"></i> ca. 8 Minuten</div><div class="col mr2"><i class="fa fa-folder-o" aria-hidden="true"></i>
    <a href="https://blog.networkchallenge.de/tech/">tech</a>
  </div>

    <div class="col mr2"><i class="fa fa-tags" aria-hidden="true"></i> <a href="https://blog.networkchallenge.de/tags/devops/">devops</a>, <a href="https://blog.networkchallenge.de/tags/docker/">docker</a>, <a href="https://blog.networkchallenge.de/tags/gcp/">gcp</a>, <a href="https://blog.networkchallenge.de/tags/k8s/">k8s</a>, <a href="https://blog.networkchallenge.de/tags/quarkus/">quarkus</a>, <a href="https://blog.networkchallenge.de/tags/tutorial/">tutorial</a>
</div> 
    
</div>

                        <hr class="small">
                    
                            Aufbau einer DevOps-Pipeline für eine Multiservice-Anwendung in Kubernetes
                    
                                </div>
                            </div>
                </div>
            </div>
       </div>
    </div>

<div class="clearfix" id="content">
        <div class="contentwrapper relative">

        
        <div class="content relative">
          
          <article>
          

<h2 id="abstract">Abstract</h2>

<p>Dieser Beitrag hat das Ziel, alle notwendigen Schritte aufzuzeigen, mit denen man eine DevOps-Pipeline in einem Kubernetes-Cluster aufbaut. Grundlegend basiert dies auf der sehr ausführlichen <a href="https://cloud.google.com/kubernetes-engine/docs/tutorials/gitops-cloud-build">Anleitung in der GCP-Doku</a>. Dabei wurde das Beispiel erweitert, um ein realistischeres Anwendungsszenario abzudecken: eine moderne Anwendung mit zugrundeliegender Microservices-Architektur die mit Canary-Deployments zu schnellen Production-Deployments führt und dabei die Gesamtqualität der Anwendung nur in einem kontrollierten Rahmen gefährdet. Dabei zeige ich die Herausforderungen auf, vor die uns ein klassisches Kubernetes-Cluster stellt.</p>

<h2 id="problemstellung">Problemstellung</h2>

<p>Das zuvor genannte, umfassende Tutorial deckt meiner Meinung nach nicht den Use-Case moderner Softwarearchitekturen ab. Daher habe ich eine Beispielanwendung gebaut, die aus insgesamt drei Komponenten besteht. Es gibt ein <em>frontend</em>, welches neben der Website auch noch einen Endpunkt mit dynamischen Grafiken anbietet (<code>/local/*</code>). Die Startseite bindet dabei Bilder von diesem lokalen Service ein. Zusätzlich referenziert die Seite aber auch einen weiteren Endpunkt im <em>frontend</em> (<code>/remote/*</code>), der Bilder von zwei entfernten Microservices (<em>rectangle</em> und <em>circle</em>) abfragt. Neben dem automatischen Deployment drei verschiedener Komponenten ist eine Herausforderung, wie in solch einer Architektur <em>canary</em>-Deployments realisiert werden.</p>


<div style="max-width: 1000px;" class="imgwrapper">   
<figure>
    <amp-img lightbox="postgallery" src="https://imgs.networkchallenge.de/screenshots/y2019/k8s-deployment-overview-1.png" 
        layout="responsive" width="1000"
        height="560" alt="Microservice-Architektur der Beispielanwendung"
        >
    </amp-img>
    
    <figcaption class="image">
        Microservice-Architektur der Beispielanwendung
    </figcaption>
    
</figure>
</div> 


<h2 id="einrichtung-einer-devops-pipeline">Einrichtung einer DevOps-Pipeline</h2>

<p>Alle folgenden Schritte basieren auf einer Implementierung in der <em>Google Cloud Platform</em> (<em>GCP</em>), da die angebotenen Services wirklich gut verzahnt sind und schnelle Erfolge bei geringsten Kosten versprechen. Für das Nachvollziehen der Schritte reicht es, ein neues Projekt anzulegen und sich in der Web-Console die <em>Cloud Shell</em> zu öffnen. Das zugehörige Git Repo befindet sich auf <a href="https://github.com/adulescentulus/k8s-canary-example">GitHub</a></p>

<h3 id="apis-aktivieren">APIs aktivieren</h3>

<p>In dem Projekt müssen einige APIs aktiviert werden:</p>

<pre><code>  gcloud services enable container.googleapis.com \
    cloudbuild.googleapis.com \
    sourcerepo.googleapis.com \
    containeranalysis.googleapis.com
</code></pre>

<h3 id="einen-k8s-cluster-bereitstellen">Einen k8s-Cluster bereitstellen</h3>

<p>Mit einem Befehl kann ein neuer Cluster konfiguriert werden. Ich habe mich hier auf die Zone <code>europe-west4-b</code> festgelegt und die Pipelinekonfiguration ist darauf abgestimmt. Zur Verringerung der Kosten nutze ich immer <em>preemptible</em> Nodes, da diese geringere Kosten verursachen.</p>

<pre><code>  gcloud container clusters create canary-example \
     --num-nodes 2 --preemptible --zone europe-west4-b
</code></pre>

<h3 id="git-konfigurieren">Git konfigurieren</h3>

<p>Falls nicht schon früher geschehen müssen wir Git für unseren Nutzer noch konfigurieren.</p>

<pre><code class="language-sh">git config --global user.email &quot;[YOUR_EMAIL_ADDRESS]&quot;
git config --global user.name &quot;[YOUR_NAME]&quot;
</code></pre>

<h3 id="zwei-neue-git-repos-anlegen">Zwei neue Git Repos anlegen</h3>

<p>Das Beispiel ist für zwei Git Repos konfiguriert, die im Kontext des Projekts angelegt werden. Diese legen wir nun an.</p>

<pre><code>gcloud source repos create canary-example
gcloud source repos create canary-env
</code></pre>

<h3 id="das-beispiel-repo-klonen">Das Beispiel-Repo klonen</h3>

<p>Mein Beispiel-Repo wird nun in das GCP-Repo geklont</p>

<pre><code class="language-sh">cd ~
git clone https://github.com/adulescentulus/k8s-canary-example.git canary-example
cd ~/canary-example
PROJECT_ID=$(gcloud config get-value project)
git remote add google \
    &quot;https://source.developers.google.com/p/${PROJECT_ID}/r/canary-example&quot;
git push google master
git push google canary:canary
</code></pre>

<h3 id="berechtigung-erteilen-für-den-zugriff-auf-die-kubernetes-engine">Berechtigung erteilen für den Zugriff auf die Kubernetes Engine</h3>

<pre><code class="language-sh">PROJECT_NUMBER=&quot;$(gcloud projects describe ${PROJECT_ID} --format='get(projectNumber)')&quot;
gcloud projects add-iam-policy-binding ${PROJECT_NUMBER} \
    --member=serviceAccount:${PROJECT_NUMBER}@cloudbuild.gserviceaccount.com \
    --role=roles/container.developer
</code></pre>

<h3 id="deployment-repo-einrichten">Deployment-Repo einrichten</h3>

<p>Die aktive k8s-Konfiguration liegt in dem Repo <em>canary-env</em>. Dieses wird nun mit Dateien aus dem <em>canary-example</em> Repo initialisiert.</p>

<pre><code class="language-sh">cd ~
gcloud source repos clone canary-env
cd ~/canary-env
git checkout -b production
cd ~/canary-env
cp -R ~/canary-example/env-template/* ~/canary-env/
git add .
git commit -m &quot;Create cloudbuild.yaml and folders for deployment&quot;
git checkout -b candidate
git push origin production
git push origin candidate
</code></pre>

<h3 id="schreibzugriff-für-cloud-build-auf-repo">Schreibzugriff für Cloud Build auf Repo</h3>

<p>Damit die Pipeline funktioniert, muss <em>Cloud Build</em> Git Commits im Repo <em>canary-env</em> durchführen. Diese Berechtigung müssen wir auch noch erteilen.</p>

<pre><code class="language-sh">PROJECT_NUMBER=&quot;$(gcloud projects describe ${PROJECT_ID} \
    --format='get(projectNumber)')&quot;
cat &gt;/tmp/canary-env-policy.yaml &lt;&lt;EOF
bindings:
- members:
  - serviceAccount:${PROJECT_NUMBER}@cloudbuild.gserviceaccount.com
  role: roles/source.writer
EOF
gcloud source repos set-iam-policy \
    canary-env /tmp/canary-env-policy.yaml
</code></pre>

<h3 id="automatisches-deployment-konfigurieren">Automatisches Deployment konfigurieren</h3>

<p>Ein Build unserer Applikationen in <em>canary-example</em> schreibt die gewünschte k8s-Konfiguration in das <em>canary-env</em> Repo. Dies löst einen automatischen Bau aus. Dafür konfigurieren wir in <em>Cloud Build</em> einen neuen Trigger für das Projekt <em>canary-env</em>:</p>

<ul>
<li>Name: Push to candidate</li>
<li>Branch (regex): candidate</li>
<li>Build configuration: cloudbuild.yaml</li>
</ul>

<h3 id="automatische-builds-für-die-services">Automatische Builds für die Services</h3>

<p>In dem Quell-Repo <em>canary-example</em> sind ingesamt drei eigenständige Services untergebracht. Um nun das Bauen dieser anzustoßen, müssen nun drei Build Trigger für den <em>master</em>-Branch angelegt werden, hier beispielhaft für das <em>frontend</em>:</p>

<ul>
<li>Name: &ldquo;frontend: Push to master&rdquo;</li>
<li>Branch (regex): master</li>
<li>Included files filter: frontend/*</li>
<li>Build configuration: frontend/cloudbuild.yaml</li>
</ul>

<p>Diese drei Trigger kann man nun nacheinander manuell ausführen. Wichtig ist aber, dass die Builds nicht gleichzeitig starten (der Zeitabstand von einer Minute je Build hat sich bewährt), denn alle drei Builds schreiben in das <em>canary-env</em> Repo und das kann nicht gleichzeitig funktionieren.</p>

<p>Zur Vorbereitung legen wir noch zwei Trigger für den <em>canary</em>-Branch an von den Services <em>frontend</em> und <em>rectangle</em>:</p>

<ul>
<li>Name: &ldquo;frontend: Push to canary&rdquo;</li>
<li>Branch (regex): canary</li>
<li>Included files filter: frontend/*</li>
<li>Build configuration: frontend/cloudbuild.yaml</li>
</ul>

<p>Diese führen wir aber noch nicht aus!</p>

<h3 id="anwendung-prüfen">Anwendung prüfen</h3>

<p>Nach dem Anstoßen der drei Builds sollten diese erfolgreich gelaufen sein und insgesamt drei Builds von <em>canary-env</em> ausgelöst haben. Ein Besuch der <em>GKE</em> Services-Seite sollte nun eine öffentliche IP mit Load-Balancer für unseren Service <em>frontend</em> zeigen. Rufen wir diese auf, dann sollte es so aussehen:</p>


<div style="max-width: 953px;" class="imgwrapper">   
<figure>
    <amp-img lightbox="postgallery" src="https://imgs.networkchallenge.de/screenshots/y2019/k8s-canary-master-deployment.png" 
        layout="responsive" width="953"
        height="570" alt="Das erfolreiche master-Deployment stellt alle Bilder grün dar"
        >
    </amp-img>
    
    <figcaption class="image">
        Das erfolreiche master-Deployment stellt alle Bilder grün dar
    </figcaption>
    
</figure>
</div> 


<p>Die Bilder in der ersten Zeile werden alle durch die <em>frontend</em>-Service ausgeliefert. Erst die beiden unteren Zeilen liefern Bilder, die das <em>frontend</em> von den jeweiligen Backends <em>rectangle</em> und <em>circle</em> abruft. Alle Bilder werden in der Version auf <em>master</em> in allen Services in Grün dargestellt.</p>

<h3 id="canary-deployment-durchführen">Canary-Deployment durchführen</h3>

<p>Um nun ein Canary-Deployment durchzuführen bedarf es keiner weiteren, großen Anstrungen. Mit den Build-Triggern für den <em>canary</em>-Branch haben wir schon alles vorbereitet. Ein Commit auf diesen Branch würde die Änderungen bauen und im k8s-Cluster ausrollen. Die Änderungen sind aber schon auf dem Branch vorhanden und müssen nun nur noch durch manuelles Auslösen der Build-Trigger ausgerollt werden. Die Builds für <em>frontend</em> und <em>rectangle</em> löst man wieder mit einer Minute Verzögerung aus.</p>


<div style="max-width: 1000px;" class="imgwrapper">   
<figure>
    <amp-img lightbox="postgallery" src="https://imgs.networkchallenge.de/screenshots/y2019/k8s-deployment-overview-2.png" 
        layout="responsive" width="1000"
        height="560" alt="Microservice-Architektur mit Canary-Deployments"
        >
    </amp-img>
    
    <figcaption class="image">
        Microservice-Architektur mit Canary-Deployments
    </figcaption>
    
</figure>
</div> 


<p>Das Ergebnis lässt sich nach wenigen Minuten in der <em>Cloud Console</em> prüfen:</p>

<pre><code class="language-sh">gcloud container clusters get-credentials canary-example --zone europe-west4-b
kubectl get deployment.apps -L branch
</code></pre>

<p>Das Ergebnis sollte folgende Ausgabe sein:</p>

<pre><code>NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE     BRANCH
circle-master      1         1         1            1           52m     master
frontend-canary    1         1         1            1           2m47s   canary
frontend-master    1         1         1            1           56m     master
rectangle-canary   1         1         1            1           2m46s   canary
rectangle-master   1         1         1            1           50m     master
</code></pre>

<p>Das Deployment enthält nun auch Instanzen des <em>canary</em>-Branch und kann nun durch Aufruf der Seite erneut getestet werden. Die Canary-Änderung im <em>frontend</em> setzt die Rahmen <em>aller</em> Bilder auf Blau und auch die lokalen Rechtecke werden in der Farbe Blau dargestellt. Die Canary-Änderung für <em>rectangle</em> stellt alle Rechtecke ebenfalls in Blau dar und sollte sich in der zweiten Zeile auswirken.</p>

<p>Das tatsächliche Ergebnis mehrer Aufrufe der Seite hintereinander sollte ungefähr so aussehen:</p>

<div style="max-width: 953px;" class="imgwrapper">
    <figure>
    <amp-carousel type="slides"
        width="953"
        height="570"
        layout="responsive"
        controls
        loop
        autoplay
        delay="2000"><amp-img src="https://imgs.networkchallenge.de/screenshots/y2019/k8s-canary-simple-lb-1.png" 
        layout="responsive" width="953"
        height="570" alt=""
        ></amp-img><amp-img src="https://imgs.networkchallenge.de/screenshots/y2019/k8s-canary-simple-lb-2.png" 
        layout="responsive" width="953"
        height="570" alt=""
        ></amp-img><amp-img src="https://imgs.networkchallenge.de/screenshots/y2019/k8s-canary-simple-lb-3.png" 
        layout="responsive" width="953"
        height="570" alt=""
        ></amp-img></amp-carousel>
    <figcaption class="image">Das Ergebnis des Canary-Deployments nach mehreren Aktualisierungen des Browsers</figcaption>
    </figure>
</div>

<p>Das Ergebnis ist also durchwachsen. Jede Aktualisierung gleicht einem wilden Blinken unserer Bilder und wir können ein Problem von Canary-Deployments mit k8s-Bordmitteln feststellen.</p>

<h2 id="fehleranalyse">Fehleranalyse</h2>

<p>Bei der Fehlerbetrachtung müssen wir zwei Phänomene unterscheiden: Die unterschiedlichen Farben in der ersten Zeile von &ldquo;Serving local images&rdquo; und die in der zweiten Zeile, die Rechtecke in &ldquo;Serving remote images&rdquo;.</p>

<p>Das erste Fehlerbild betrifft die Darstellung von Bildern, die alle, wie auch die <code>index.html</code>, vom <em>frontend</em>-Service bereitgestellt werden. Allerdings sind für die <code>index.html</code> und die vier Bilder insgesamt fünf HTTP-Requests notwendig. Jeder Request hat die Chance entweder vom <em>master</em>- oder <em>canary</em>-Release bedient zu werden.</p>

<p>Das zweite Fehlerbild zeigt uns die &ldquo;Komplexität&rdquo; unserer Applikation und die Grenzen eines &ldquo;dummen&rdquo; Load-Balancers auf. Unsere Services hängen voneinander ab, das heißt, dass ein Zugriff auf das <em>canary-frontend</em> auch einen nachgelagerten Zugriff auf das <em>canary-rectangle</em>-Service auslösen müsste. Der Load-Balancer selektiert die Deployments in unserer k8s-Konfiguration nur nach Labels <code>app=frontend</code> oder <code>app=rectangle</code> und prüft nicht, ob der Request eventuell von einem <em>canary</em>-Service initiiert wurde.</p>

<p>Die Lösung dieser beiden Problem ist nach meinem Kenntnisstand nicht trivial und kann eventuell durch einen Ingress-Controller (in Teilen) oder mit einem Service-Mesh wie <a href="https://istio.io">istio</a> gelöst werden. Meine Lösungen werde ich im Rahmen dieser Artikelserie hier im Blog veröffentlichen.</p>

<h2 id="details-der-deployment-pipeline">Details der Deployment-Pipeline</h2>

<p>Zu Beginn habe ich nur die Schritte der Anleitung mit wenig Details weggeschrieben. Ich möchte hier noch auf ein paar Details der Implementierung eingehen. Einige Dinge werden in dem bereits verlinkten <a href="https://cloud.google.com/kubernetes-engine/docs/tutorials/gitops-cloud-build">Tutorial der GCP Doku</a> erläutert.</p>

<h3 id="k8s-konfiguration">k8s-Konfiguration</h3>

<p>Jeder Service ist selbst für eine funktionierende k8s-Konfigurationsdatei verantwortlich. In jedem Projektverzeichnis befindet sich eine <code>k8s.yaml.tpl</code> die am Ende des Builds in das <em>canary-env</em>-Projekt übertragen wird. Dabei wird in dem Template der aktuelle Branch als Label gesetzt. Ebenso wird der Commit-SHA für das Docker-Image und die <em>GCP</em>-Project-ID ersetzt. Die Datei wird dann im Ziel-Repo mit dem Branch als Suffix abgelegt, so dass jeder Branch eine separate Konfiguration besitzt.</p>

<p>Jede Änderung im <em>canary-env</em>-Repo führt zu einem <em>kubectl</em>-Durchlauf. Es werden immer zuerst alle Canary-Deployments gelöscht und dann alle Konfigurationsdateien in den drei Service-Verzeichnissen angewandt. Das sorgt zwar immer für ein Aus- und Anschalten der Canary-Services, aber so bleibt die Cluster-Konsistenz gewahrt.</p>

<h3 id="löschen-der-canary-deployments">Löschen der Canary-Deployments</h3>

<p>Wie zuvor erwähnt führt jeder <em>canary-env</em>-Build eine Cluster-Konfiguration durch und löscht Canary-Deployments. Wird nun ein Service auf dem <em>master</em>-Branch deployed werden hier <em>alle</em> anderen Branch-Konfigurationen für diesen Service gelöscht, so dass diese nicht mehr neu deployed werden. Das macht auch Sinn. Im Continuous Deployment Lifecycle sollte ein Canary-Feature immer auf <em>master</em> gemerged werden, was das Canary-Deployment überflüssig macht.</p>

<h3 id="probleme-bei-vielen-commits">Probleme bei vielen Commits</h3>

<p>Die aktuelle Implementierung hat definitiv noch einen Haken: parallele Commits in den einzelnen Services. Dadurch dass jeder Build auch in das <em>canary-env</em>-Repo schreibt, kann die parallele Ausführung zu einem unerwarteten Abbruch wegen eines Git-Fehlers führen. Dies läßt sich in <em>Google Cloud Build</em> leider nicht einschränken. Parallele Builds sind definitiv vorgesehen. Man könnte dies nur durch clevere Scripts in der Build-Pipeline beheben.</p>

<h3 id="quarkus-und-graalvm">Quarkus und GraalVM</h3>

<p>Wie auch schon bei meinem <a href="/tech/google-cloud-run-ausprobiert/">Test von Google Cloud Run</a> setze ich konsequent auf <a href="https://quarkus.io">Quarkus</a>, dem &ldquo;Kubernetes Native Java stack&rdquo;. Die Startzeiten der Container sind phänomenal. Alle Service-Builds in meinem Beispielprojekt laufen wegen der kürzeren Compile-Zeit in einer JVM. In der <code>cloudbuild.yaml</code> kann einfach zwischen <code>Dockerfile.jvm</code> und <code>Dockerfile.native</code> gewechselt werden, um noch weiter von den Optimierungen der <em>GraalVM</em> zu profitieren.</p>

<h2 id="fazit">Fazit</h2>

<p>Canary-Deployments in komplexeren Microservice-Architekturen sind leider keine einfache Angelegenheit. Es ist definitiv eine lösbare Aufgabe, wenn man erst einmal alle Probleme vor Augen hat. Diese Artikelserie wird in der Folge hoffentlich mindestens eine Lösung hervorbringen.</p>
</article>

          <hr>
          <amp-ad media="(min-width:64.06rem)"
              data-block-on-consent="_till_accepted"
              layout="fixed-height"
              height="280"
              type="adsense"
              data-ad-client="ca-pub-4404883883603593"
              data-ad-slot="9740719223">
          </amp-ad>
          <amp-ad media="not all and (min-width:64.06rem)"
              data-block-on-consent="_till_accepted"
              width="100vw" height=320
              type="adsense"
              data-ad-client="ca-pub-4404883883603593"
              data-ad-slot="7221177726"
              data-auto-format="rspv"
              data-full-width>
              <div overflow></div>
          </amp-ad>
          
        </div>
            <div class="sidebar relative">
                <div class="clearfix">
                      <div class="widget border p2">
        
                        <div class="col col-12 md-col md-col-12 center title">
                              <a name="author">Erstellt von</a>
                        </div>
                          
                          <div class="col col-4 lg-col lg-col-12">
                            <div class="avatar p2 mx-auto">
                                <amp-img class="circle self-center" src="https://imgs.networkchallenge.de/200x/avatar/groll.jpg" 
                                    layout="responsive" width="200"
                                    height="200" alt="author"
                                    srcset="https://imgs.networkchallenge.de/100x/avatar/groll.jpg 100w, https://imgs.networkchallenge.de/200x/avatar/groll.jpg 200w, https://imgs.networkchallenge.de/400x/avatar/groll.jpg 400w">
                                </amp-img>
                              <p class="center">Andreas Groll</p>
                            </div>
                          </div>
                          <div class="col col-8 lg-col lg-col-12 p2">
                              <div class="col-xs-12">
                                <p>
                                  Andreas ist der Betreiber dieses Blogs. Er schreibt aktuell vermehrt über seine Weltreise und daher nur gelegentlich über IT-Themen.
                                </p>
                              </div>
                            
                                <div class="col-xs-12 mt2">
                                    
                                      <a href="https://www.instagram.com/holygrolli/"><span class="fa-stack fa-lg"><i class="fa fa-square fa-stack-2x"></i><i class="fa fa-instagram fa-stack-1x fa-inverse"></i></span></a>
                                    
                                      <a href="https://facebook.com/andreas.gro11"><span class="fa-stack fa-lg"><i class="fa fa-square fa-stack-2x"></i><i class="fa fa-facebook fa-stack-1x fa-inverse"></i></span></a>
                                    
                                      <a href="https://github.com/holygrolli"><span class="fa-stack fa-lg"><i class="fa fa-square fa-stack-2x"></i><i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a>
                                    
                                </div>
                              
                          </div>
                      </div>
                  </div>
                  <div class="clearfix">
                      <div class="widget p2 mt2">
        
                        <div class="col col-12 md-col md-col-12 center">
                            <amp-web-push
                            id="amp-web-push"
                            layout="nodisplay"
                            helper-iframe-url="https://blog.networkchallenge.de/amp-helper-frame.html?appId=4373a84e-c094-48e0-9e5e-58d81c8fc1b9"
                            permission-dialog-url="https://blog.networkchallenge.de/amp-permission-dialog.html?appId=4373a84e-c094-48e0-9e5e-58d81c8fc1b9"
                            service-worker-url="https://blog.networkchallenge.de/OneSignalSDKWorker.js?appId=4373a84e-c094-48e0-9e5e-58d81c8fc1b9"
                          ></amp-web-push>
                          
                  <amp-web-push-widget visibility="unsubscribed" layout="fixed" width="268" height="45">
                      <button class="subscribe" on="tap:amp-web-push.subscribe">
                          <i class="fa fa-bell fa-lg mr2" aria-hidden="true"></i> Neuigkeiten abonnieren!
                      </button>
                    </amp-web-push-widget>

                    
                    <amp-web-push-widget visibility="subscribed" layout="fixed" width="268" height="45">
                        <button class="unsubscribe" on="tap:amp-web-push.unsubscribe">
                            <i class="fa fa-bell-slash fa-lg mr2" aria-hidden="true"></i> Abmelden von Neuigkeiten</button>
                    </amp-web-push-widget>
                        </div>
                      </div>
                  </div>
                  
              </div>
              <div class="content relative left">
                

<amp-iframe width=600 height=140
    layout="responsive"
    sandbox="allow-scripts allow-same-origin allow-modals allow-popups allow-forms"
    resizable
    src="https://blogamp.networkchallenge.de/disqus/dsqs.html#%2ftech%2fk8s-einstieg-in-canary-deployments%2f">
    <div overflow tabindex=0 role=button aria-label="">Read more...</div>
</amp-iframe>
   


              </div>
        </div>

                  
    </div>
            
          
          <amp-geo layout="nodisplay">
              <script type="application/json">
                {
                  "ISOCountryGroups": {
                    "eu": ["preset-eea"]
                  }
                }
              </script>
            </amp-geo>
          <amp-consent id="ncCookieConsent"
          layout="nodisplay">
          <script type="application/json">
            {
              "consents": {
                "ncCookieConsent": {
                  "promptIfUnknownForGeoGroup": "eu",
                  "promptUI": "consentDialog"
                }
              }
            }
          </script>
          <div class="popupOverlay"
            id="consentDialog">
            <div class="consentPopup">
              <div class="h2 m1">Cookie-Richtlinie</div>
              <p class="m1">Diese Website benutzt Cookies, u.a. zur automatisierten Nutzerauswertung mit Google Analytics.</p>
              <p class="m1">Bitte beachten Sie die <a href="https://blog.networkchallenge.de/privacypolicy/" title="Datenschutzerklärung">Datenschutzerklärung</a>!</p>
              <button on="tap:ncCookieConsent.accept" role="button"
                class="ampstart-btn ampstart-btn-secondary caps mx1">Akzeptieren</button>
            </div>
          </div>
        </amp-consent>
  
        <hr>
        
        <footer>
            <div class="clearfix">
                    <div class="sm-col-12 md-col-9 mx-auto">
                      <ul class="list-reset flex justify-center items-center">
                        
                        
                        
                        <li>
                          <a href="https://www.instagram.com/holygrolli/">
                            <span class="fa-stack fa-lg">
                              <i class="fa fa-circle fa-stack-2x"></i>
                              <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                            </span>
                          </a>
                        </li>
                        
                        <li>
                          <a href="https://facebook.com/andreas.gro11">
                            <span class="fa-stack fa-lg">
                              <i class="fa fa-circle fa-stack-2x"></i>
                              <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                          </a>
                        </li>
                        
                        <li>
                          <a href="https://github.com/holygrolli">
                            <span class="fa-stack fa-lg">
                              <i class="fa fa-circle fa-stack-2x"></i>
                              <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                          </a>
                        </li>
                        
                      </ul>
                      <p class="center ampstart-small-text">
                        <a href="https://blog.networkchallenge.de/impressum/" title="Impressum">Impressum</a>
                        <br><a href="https://blog.networkchallenge.de/privacypolicy/" title="Datenschutzerklärung">Datenschutzerklärung</a>
                        <br>Copyright © <a href="https://blog.networkchallenge.de/about/ ">Andreas Groll</a> 2021</p>
                    </div>
            </div>
        </footer>
    </body>
</html>